{extends file="layout/base.tpl"}

{block name="body"} 
{block name="header"} 


<link href="{assets_url()}backend/vendors/fullcalendar/main.min.css" rel="stylesheet">

{/block} 

<div class="row g-3 mb-3">
	<div class="col-xxl-8">
		<div class="card mb-3">
			<div class="card-body">
				<div class="row justify-content-between align-items-center">
					<div class="col-md">
						<input type="text" class="form-control mb-2 mb-md-0" id="post-shortlink" value="{base_url()}referral/{log_user_name()}">	 
					</div>
					<div class="col-auto">
						<button class="btn btn-outline-success btn-sm me-2" id="copy-button" onclick="copyReferral()" data-clipboard-target="#post-shortlink" class="card-icon">{lang('copy')}</button> 
						<a href="{base_url()}/signup"><button class="btn btn-falcon-primary btn-sm" type="button">Go</button></a>

					</div>
				</div>
			</div>
		</div>

		{* <div class="card overflow-hidden mb-3">
			<div class="card-body position-relative">
				<div class="row g-2 align-items-sm-center">
					<div class="col">
						<div class="row align-items-center">

							<label >Referral Link</label>
							<div class="col-lg-8" >

								<ul class="breadcrumb">

									<input type="text" class="form-control" id="post-shortlink" value="{base_url()}referral/{log_user_name()}">	 
									<button class="btn btn-primary float-right" id="copy-button" onclick="copyReferral()" data-clipboard-target="#post-shortlink" class="card-icon">{lang('copy')}</button>
								</ul>


							</div>
							<div class="col-12 col-sm-auto ms-auto">
								<a href="{base_url()}/signup"><button class="btn btn-falcon-primary" type="button">Go</button></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div> *}
	</div>
</div>


<div class="row g-0">
	<div class="col-lg-6 pe-lg-2 mb-3">
		<div class="card h-lg-100 overflow-hidden">
			<div class="card-header bg-light">
				<div class="row align-items-center">
					<div class="col">
						<h6 class="mb-0">User Wallet Details <br><br>
						Total = {cur_format($wallet_details['total_wallet'])}</h6>
					</div>

				</div>
			</div>
			<div class="card-body p-0">
				<div class="row g-0 align-items-center py-2 position-relative border-bottom border-200">
					<div class="col ps-card py-1 position-static">
						<div class="d-flex align-items-center">
							<div class="avatar avatar-xl me-3">
								<div class="avatar-name rounded-circle bg-soft-primary text-dark"><span class="fs-0 text-primary">R</span></div>
							</div>
							<div class="flex-1">
								<h6 class="mb-0 d-flex align-items-center"><a class="text-800 stretched-link" href="#!">Referral Bonus</a><span class="badge rounded-pill ms-2 bg-200 text-primary">{$referral_per}%</span></h6>
							</div>
						</div>
					</div>
					<div class="col py-1">
						<div class="row flex-end-center g-0">
							<div class="col-auto pe-2">
								<div class="fs--1 fw-semi-bold">{cur_format($wallet_details['referral_total'])}</div>
							</div>
							<div class="col-5 pe-card ps-2">
								<div class="progress bg-200 me-2" style="height: 5px;">
									<div class="progress-bar rounded-pill" role="progressbar" style="width: {$referral_per}%" aria-valuenow="{$referral_per}" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row g-0 align-items-center py-2 position-relative border-bottom border-200">
					<div class="col ps-card py-1 position-static">
						<div class="d-flex align-items-center">
							<div class="avatar avatar-xl me-3">
								<div class="avatar-name rounded-circle bg-soft-success text-dark"><span class="fs-0 text-success">L</span></div>
							</div>
							<div class="flex-1">
								<h6 class="mb-0 d-flex align-items-center"><a class="text-800 stretched-link" href="#!">Level Bonus</a><span class="badge rounded-pill ms-2 bg-200 text-primary">{$level_per}%</span></h6>
							</div>
						</div>
					</div>
					<div class="col py-1">
						<div class="row flex-end-center g-0">
							<div class="col-auto pe-2">
								<div class="fs--1 fw-semi-bold">{cur_format($wallet_details['level_total'])}</div>
							</div>
							<div class="col-5 pe-card ps-2">
								<div class="progress bg-200 me-2" style="height: 5px;">
									<div class="progress-bar rounded-pill" role="progressbar" style="width: {$level_per}%" aria-valuenow="{$level_per}" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row g-0 align-items-center py-2 position-relative border-bottom border-200">
					<div class="col ps-card py-1 position-static">
						<div class="d-flex align-items-center">
							<div class="avatar avatar-xl me-3">
								<div class="avatar-name rounded-circle bg-soft-info text-dark"><span class="fs-0 text-info">W</span></div>
							</div>
							<div class="flex-1">
								<h6 class="mb-0 d-flex align-items-center"><a class="text-800 stretched-link" href="#!">Wallet Withdrawal</a><span class="badge rounded-pill ms-2 bg-200 text-primary">{$withdrawal_per}%</span></h6>
							</div>
						</div>
					</div>
					<div class="col py-1">
						<div class="row flex-end-center g-0">
							<div class="col-auto pe-2">
								<div class="fs--1 fw-semi-bold">{cur_format($wallet_details['wallet_withdrawel'])}</div>
							</div>
							<div class="col-5 pe-card ps-2">
								<div class="progress bg-200 me-2" style="height: 5px;">
									<div class="progress-bar rounded-pill" role="progressbar" style="width: {$withdrawal_per}%" aria-valuenow="{$withdrawal_per}" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
			<div class="card-footer bg-light p-0"><a class="btn btn-sm btn-link d-block w-100 py-2" href="#!">Show all projects<span class="fas fa-chevron-right ms-1 fs--2"></span></a></div>
		</div>
	</div>
	<div class="col-lg-6 ps-lg-2 mb-3">
		<div class="card h-lg-100">
			<div class="card-header">
				<div class="row flex-between-center">
					<div class="col-auto">
						<h6 class="mb-0">User Joinings</h6>
					</div>
					<div class="col-auto d-flex">
						<select class="form-select form-select-sm select-month me-2">
							{foreach $month_year as $v}
							<option value="{$v.value}">{$v.month_name} {$v.year}</option>
							{/foreach}
						</select>

					</div>
				</div>
			</div>
			<div class="card-body h-100 pe-0">
				<div class="joinings-graph h-100" data-echart-responsive="true"></div>
			</div>
		</div>
	</div>
</div>


<div class="row g-3">
	<div class="col-xxl-8">
		<div class="card overflow-hidden h-100">
			<div class="card-body p-0 management-calendar">
				<div class="row g-3">
					<div class="col-md-7">

						<div class="calendar-outline px-3" id="managementAppCalendar" data-calendar-option="{ &quot;title&quot;:&quot;management-calendar-title&quot;,&quot;day&quot;:&quot;management-calendar-day&quot;,&quot;events&quot;:&quot;management-calendar-events&quot;}" style="height: 360px;"></div>
					</div>
					<div class="col-md-5 bg-light pt-3">
						<div class="px-3">
							<h4 class="mb-0 fs-0 fs-sm-1 fs-lg-2" id="management-calendar-title"></h4>
							<p class="text-500 mb-0" id="management-calendar-day"></p>
							<ul class="list-unstyled mt-3 scrollbar management-calendar-events" id="management-calendar-events"> 
							</ul> 
						</div> 
					</div> 
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="eventDetailsModal" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content border"></div>
		</div>
	</div>


	<div class="col-xxl-9 col-md-12">
		<div class="card z-index-1" id="recentPurchaseTable" data-list="{ &quot;valueNames&quot;:[&quot;name&quot;,&quot;email&quot;,&quot;product&quot;,&quot;payment&quot;,&quot;amount&quot;],&quot;page&quot;:7,&quot;pagination&quot;:true}">
			<div class="card-header">
				<div class="row flex-between-center">
					<div class="col-6 col-sm-auto d-flex align-items-center pe-0">
						<h5 class="fs-0 mb-0 text-nowrap py-2 py-xl-0">Recent Joinings </h5>
					</div>

				</div>
			</div>
			<div class="card-body px-0 py-0">
				<div class="table-responsive scrollbar">
					<table class="table table-sm fs--1 mb-0 overflow-hidden">
						<thead class="bg-200 text-900">
							<tr>

								<th class="sort pe-1 align-middle white-space-nowrap" >User Name</th>
								<th class="sort pe-1 align-middle white-space-nowrap" >Full Name</th>
								<th class="sort pe-1 align-middle white-space-nowrap" >Mobile</th>
								<th class="sort pe-1 align-middle white-space-nowrap text-center" >Email</th>
								<th class="sort pe-1 align-middle white-space-nowrap text-end" >Joining Date</th>
								<th class="no-sort pe-1 align-middle data-table-row-action"></th>
							</tr>
						</thead>

						{foreach $recent_joiners as $v}

						<tbody class="list" id="table-purchase-body">
							<tr class="btn-reveal-trigger">

								<th class="align-middle white-space-nowrap name"><a href="{base_url()}admin/member/profile/?user_name={$v.user_name}">{$v.user_name}</a></th>
								<td class="align-middle white-space-nowrap email">{$v.full_name}</td>

								<td class="align-middle white-space-nowrap product">{$v.mobile}</td>
								<td class="align-middle text-center fs-0 white-space-nowrap payment">
									{$v.email}
								</td>
								<td class="align-middle text-end amount">{date('d-M-y',strtotime($v.date_of_joining))}</td>
								<td class="align-middle white-space-nowrap text-end">
									<div class="dropstart font-sans-serif position-static d-inline-block">
										<button class="btn btn-link text-600 btn-sm dropdown-toggle btn-reveal float-end" type="button" id="dropdown0" data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent"><svg class="svg-inline--fa fa-ellipsis-h fa-w-16 fs--1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="ellipsis-h" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path></svg>
										</button>
										<div class="dropdown-menu dropdown-menu-end border py-2" aria-labelledby="dropdown0"><a class="dropdown-item" href="{base_url()}admin/member/profile/?user_name={$v.user_name}">View</a>
											<a class="dropdown-item" href="{base_url()}admin/member/profile/?user_name={$v.user_name}">Edit</a>

										</div>
									</div>
								</td>
							</tr>

						</tbody>

						{/foreach}
					</table>
				</div>
			</div>

		</div>
	</div>



	<div class="col-lg-7">
		<div class="card mb-4">
			<div class="card-header d-flex flex-between-center bg-light py-2">
				<h6 class="mb-0">Wallet Details</h6>

			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-auto mt-md-0">
						<div class="row flex-md-column justify-content-between h-md-100 ms-0">
							<div class="col border-end border-md-end-0 border-md-bottom pt-3">
								<h6 class="fs--2 text-700"><span class="fas fa-circle text-primary me-2"></span>Referral<br>Bonus</h6>
								<h5 class="text-700 fs-0">{$sum_ref}</h5>
							</div>
							<div class="col border-end border-md-end-0 border-md-bottom pt-3 pt-md-4">
								<h6 class="fs--2 text-700"><span class="fas fa-circle text-success me-2"></span>Level<br>Bonus </h6>
								<h5 class="text-700 fs-0">{$sum_lev}</h5>
							</div>
							<div class="col pt-3 pt-md-4">
								<h6 class="fs--2 text-700"><span class="fas fa-circle text-info me-2"></span>Rank<br>Bonus </h6>
								<h5 class="text-700 fs-0">{$sum_rank}</h5>
							</div>
						</div>
					</div>
					<div class="col-md-auto echart-active-users-report-container">
						<div class="echart-active-users-report h-100" data-echart-responsive="true"></div>
					</div>
				</div>
			</div>
			<div class="card-footer bg-light py-2">
				<div class="row flex-between-center g-0">

					<div class="col-auto">
						<h6 class="mb-0"><a class="py-2" href="#!">Wallet Details<span class="fas fa-chevron-right ms-1 fs--2"></span></a></h6>
					</div>
				</div>
			</div>
		</div>

	</div>

</div> 
{/block}


{block name="footer"}  
<script src="{assets_url()}backend/vendors/echarts/echarts.min.js"></script>
<script src="{assets_url()}backend/vendors/progressbar/progressbar.min.js"></script>  
<script src="{assets_url()}backend/vendors/fullcalendar/main.min.js"></script>
<script src="{assets_url()}backend/js/flatpickr.js"></script>  
<script src="{assets_url()}backend/vendors/dayjs/dayjs.min.js"></script> 
<script type="text/javascript">
	var thisDay = window.dayjs && window.dayjs().format('DD');
	var plus2Day = window.dayjs && window.dayjs().add(2, 'day').format('DD');
	var thisMonthNumber = window.dayjs && window.dayjs().format('MM');
	var thisMonthName = window.dayjs && window.dayjs().format('MMM');
	var upcomingMonthNumber = window.dayjs && window.dayjs().add(1, 'month').format('MM');
	var upcomingMonthName = window.dayjs && window.dayjs().format('MMM');
	var thisYear = window.dayjs && window.dayjs().format('YYYY');
	var managementEvents = {$json_events};

	var echartSetOption = function echartSetOption(chart, userOptions, getDefaultOptions) {
		var themeController = document.body; 

		chart.setOption(window._.merge(getDefaultOptions(), userOptions));
		themeController.addEventListener('clickControl', function (_ref16) {
			var control = _ref16.detail.control;

			if (control === 'theme') {
				chart.setOption(window._.merge(getDefaultOptions(), userOptions));
			}
		});
	};

	var joiningsGraph = function joiningsGraph() {
		var ECHART_LINE_TOTAL_SALES = '.joinings-graph';
		var SELECT_MONTH = '.select-month';
		var $echartsLineTotalSales = document.querySelector(ECHART_LINE_TOTAL_SALES);
		var months ={$month_names};

		function getFormatter(params) {
			var _params$ = params[0],
			name = _params$.name,
			value = _params$.value;
			var date = new Date(name);
			return "".concat(months[0], " ").concat(date.getDate(), ", ").concat(value);
		}


		if ($echartsLineTotalSales) {
			var userOptions = utils.getData($echartsLineTotalSales, 'options');
			var chart = window.echarts.init($echartsLineTotalSales);


			var monthsnumber = [{$m1},{$m2},{$m3},{$m4},{$m5}, {$m6},{$m7},{$m8}, {$m9},{$m10},{$m11},{$m12}
			];




			var getDefaultOptions = function getDefaultOptions() {
				return {
					color: utils.getGrays()['100'],
					tooltip: {
						trigger: 'axis',
						padding: [7, 10],
						backgroundColor: utils.getGrays()['100'],
						borderColor: utils.getGrays()['300'],
						textStyle: {
							color: utils.getColors().dark
						},
						borderWidth: 1,
						formatter: function formatter(params) {
							return getFormatter(params);
						},
						transitionDuration: 0,
						position: function position(pos, params, dom, rect, size) {
							return getPosition(pos, params, dom, rect, size);
						}
					},
					xAxis: {
						type: 'category',
						data: ['2019-01-04', '2019-01-08', '2019-01-12', '2019-01-16', '2019-01-20', '2019-01-24', '2019-01-28', '2019-01-31'],
						boundaryGap: false,
						axisPointer: {
							lineStyle: {
								color: utils.getGrays()['300'],
								type: 'dashed'
							}
						},
						splitLine: {
							show: false
						},
						axisLine: {
							lineStyle: {
								color: utils.rgbaColor('#000', 0.01),
								type: 'dashed'
							}
						},
						axisTick: {
							show: false
						},
						axisLabel: {
							color: utils.getGrays()['400'],
							formatter: function formatter(value) {
								var date = new Date(value);
								return "".concat(months[date.getMonth()], " ").concat(date.getDate());
							},
							margin: 15
						}
					},
					yAxis: {
						type: 'value',
						axisPointer: {
							show: false
						},
						splitLine: {
							lineStyle: {
								color: utils.getGrays()['300'],
								type: 'dashed'
							}
						},
						boundaryGap: false,
						axisLabel: {
							show: true,
							color: utils.getGrays()['400'],
							margin: 15
						},
						axisTick: {
							show: false
						},
						axisLine: {
							show: false
						}
					},
					series: [{
						type: 'line',
						data: monthsnumber[0],
						lineStyle: {
							color: utils.getColors().primary
						},
						itemStyle: {
							borderColor: utils.getColors().primary,
							borderWidth: 2
						},
						symbol: 'circle',
						symbolSize: 10,
						smooth: false,
						hoverAnimation: true,
						areaStyle: {
							color: {
								type: 'linear',
								x: 0,
								y: 0,
								x2: 0,
								y2: 1,
								colorStops: [{
									offset: 0,
									color: utils.rgbaColor(utils.getColors().primary, 0.2)
								}, {
									offset: 1,
									color: utils.rgbaColor(utils.getColors().primary, 0)
								}]
							}
						}
					}],
					grid: {
						right: '28px',
						left: '40px',
						bottom: '15%',
						top: '5%'
					}
				};
			};

			echartSetOption(chart, userOptions, getDefaultOptions);   the selected month

			var monthSelect = document.querySelector(SELECT_MONTH);

			if (monthSelect) {
				monthSelect.addEventListener('change', function (e) {
					var month = e.currentTarget.value;
					var data = monthsnumber[month];
					chart.setOption({
						tooltip: {
							formatter: function formatter(params) {
								var _params$2 = params[0],
								name = _params$2.name,
								value = _params$2.value;
								var date = new Date(name);
								return "".concat(months[month], " ").concat(date.getDate(), ", ").concat(value);
							}
						},
						xAxis: {
							axisLabel: {
								formatter: function formatter(value) {
									var date = new Date(value);
									return "".concat(months[month], " ").concat(date.getDate());
								},
								margin: 15
							}
						},
						series: [{
							data: data
						}]
					});
				});
			}
		}
	};

	docReady(joiningsGraph);

	var activeUsersChartReportInit = function activeUsersChartReportInit() {
		var $echartsActiveUsersChart = document.querySelector('.echart-active-users-report');

		if ($echartsActiveUsersChart) {
			var userOptions = utils.getData($echartsActiveUsersChart, 'options');
			var chart = window.echarts.init($echartsActiveUsersChart);

			var _tooltipFormatter = function _tooltipFormatter(params) {
				return "\n      <div>\n        <p class='mb-2 text-600'>".concat(window.dayjs(params[0].axisValue).format('MMM DD, YYYY'), "</p>\n        <div class='ms-1'>\n          <h6 class=\"fs--1 text-700\"><span class=\"fas fa-circle text-primary me-2\"></span>").concat(params[0].value, "</h6>\n          <h6 class=\"fs--1 text-700\"><span class=\"fas fa-circle text-success me-2\"></span>").concat(params[1].value, "</h6>\n          <h6 class=\"fs--1 text-700\"><span class=\"fas fa-circle text-info me-2\"></span>").concat(params[2].value, "</h6>\n        </div>\n      </div>\n      ");
			};

			var getDefaultOptions = function getDefaultOptions() {
				return {
					color: [utils.getColor('primary'), utils.getColor('success'), utils.getColor('info')],
					tooltip: {
						trigger: 'axis',
						padding: [7, 10],
						backgroundColor: utils.getGrays()['100'],
						borderColor: utils.getGrays()['300'],
						textStyle: {
							color: utils.getColors().dark
						},
						borderWidth: 1,
						transitionDuration: 0,
						position: function position(pos, params, dom, rect, size) {
							return getPosition(pos, params, dom, rect, size);
						},
						formatter: _tooltipFormatter
					},
					xAxis: {
						type: 'category',
						data: utils.getPastDates(30).map(function (date) {
							return window.dayjs(date).format('DD MMM, YYYY');
						}),
						boundaryGap: false,
						silent: true,
						axisPointer: {
							lineStyle: {
								color: utils.getGrays()['300']
							}
						},
						splitLine: {
							show: false
						},
						axisLine: {
							lineStyle: {
								color: utils.getGrays()['300']
							}
						},
						axisTick: {
							show: true,
							length: 20,
							lineStyle: {
								color: utils.getGrays()['200']
							},
							interval: 5
						},
						axisLabel: {
							color: utils.getGrays()['600'],
							formatter: function formatter(value) {
								return window.dayjs(value).format('MMM DD');
							},
							align: 'left',
							fontSize: 11,
							padding: [0, 0, 0, 5],
							interval: 5
						}
					},
					yAxis: {
						type: 'value',
						position: 'right',
						axisPointer: {
							show: false
						},
						splitLine: {
							lineStyle: {
								color: utils.getGrays()['200']
							}
						},
						axisLabel: {
							show: true,
							color: utils.getGrays()['600'],
							formatter: function formatter(value) {
								return "".concat(Math.round(value / 1000 * 10) / 10, "k");
							}
						},
						axisTick: {
							show: false
						},
						axisLine: {
							show: false
						}
					},
					series: [{
						type: 'line',

						data: {$ref},
						showSymbol: false,
						symbol: 'circle',
						itemStyle: {
							borderColor: utils.getColors().primary,
							borderWidth: 2
						},
						lineStyle: {
							color: utils.getColor('primary')
						},
						symbolSize: 2
					}, {
						type: 'line',
						data: {$lev},


						showSymbol: false,
						symbol: 'circle',
						itemStyle: {
							borderColor: utils.getColors().success,
							borderWidth: 2
						},
						lineStyle: {
							color: utils.getColor('success')
						},
						symbolSize: 2
					}, {
						type: 'line',
						data: {$rank},
						showSymbol: false,
						symbol: 'circle',
						itemStyle: {
							borderColor: utils.getColors().info,
							borderWidth: 2
						},
						lineStyle: {
							color: utils.getColor('info')
						},
						symbolSize: 2
					}],
					grid: {
						right: '30px',
						left: '5px',
						bottom: '20px',
						top: '20px'
					}
				};
			};

			echartSetOption(chart, userOptions, getDefaultOptions);
		}
	};
	docReady(activeUsersChartReportInit);

	function copyReferral() { 
		var copyText = document.getElementById("post-shortlink"); 
		copyText.select();
		copyText.setSelectionRange(0, 99999); 
		navigator.clipboard.writeText(copyText.value); 
	}

</script>
{/block}
