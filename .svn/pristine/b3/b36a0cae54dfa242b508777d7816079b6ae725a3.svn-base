{extends file="login/layout.tpl"}
{block name="header"}

{/block}
{block name="body"} 

<div class="col-md-6 col-lg-6 col-xl-5 bg-white py-4">
    <div class="login d-flex align-items-center py-2">
        <!-- Demo content-->
        <div class="container p-0">
            {include file="layout/flash_message.tpl"}
            {form_open('', 'class="form form-horizontal form-simple needs-validation" novalidate="" id="login-form"')}
            <div class="row">
                <div class="col-md-10 col-lg-10 col-xl-9 mx-auto">
                    <div class="card-sigin">
                        <div class="mb-5 d-flex">
                            <a  class="header-logo"><img src="{assets_url()}images/logo/{$site_details['logo']} " class="desktop-logo ht-40" alt="logo">
                                <img src="{assets_url()}images/logo/{$site_details['logo']}"
                                class="desktop-white ht-40" alt="logo">
                            </a>
                        </div>
                        <div class="card-sigin">
                            <div class="main-signup-header">
                                <h3>Welcome back!</h3>
                                <h6 class="fw-medium mb-4 fs-17">Please sign in to continue.</h6>
                                <form>
                                    <div class="form-group mb-3">
                                        <label class="form-label">Username</label>
                                        <input class="form-control" type="text" placeholder="Enter Username" name="user_name" required  {if $user_name}value="{$user_name}"{/if} />
                                        {form_error('user_name')}
                                    </div>
                                    <div class="mb-3 position-relative">
                                    <label class="mb-1"><strong>Password</strong></label>
                                    <div class="input-group">
                                        <input type="password" id="dz-password" class="form-control" name="pass" required {if $password} value="{$password}" {/if} placeholder="Password">
                                        
                                            <span class="input-group-text show-pass eye">
                                                <i class="fa fa-eye-slash" id="eyeSlashIcon" style="display: none;"></i>
                                                <i class="fa fa-eye" id="eyeIcon"></i>
                                            </span>
                                        
                                    </div>
                                </div>
                                        
                                                        {form_error('pass')}
                                    <div class="text-danger error-login"></div>
                                    <button type="submit" class="btn btn-primary btn-block w-100">{lang('button_login')}</button>

                                </form>
                                <div class="main-signin-footer mt-5">
                                    <p class="mb-1"><a href="{base_url('forgot-password')}">{lang('forgot_password')}</a></p>
                                    <p>Don't have an account? <a href="{base_url()}signup">{lang('create_account')}</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {form_close()}
        </div><!-- End -->
    </div>
</div>

{/block}
{block name="footer"}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const eyeSlashIcon = document.getElementById('eyeSlashIcon');
    const eyeIcon = document.getElementById('eyeIcon');
    const passwordField = document.getElementById('dz-password');

    eyeIcon.addEventListener('click', function() {
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            eyeIcon.style.display = 'none';
            eyeSlashIcon.style.display = 'inline-block';
        } else {
            passwordField.type = 'password';
            eyeIcon.style.display = 'inline-block';
            eyeSlashIcon.style.display = 'none';
        }
    });

    eyeSlashIcon.addEventListener('click', function() {
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            eyeIcon.style.display = 'none';
            eyeSlashIcon.style.display = 'inline-block';
        } else {
            passwordField.type = 'password';
            eyeIcon.style.display = 'inline-block';
            eyeSlashIcon.style.display = 'none';
        }
    });
});
</script>
<script type="text/javascript">
    (function () {
        'use strict'

        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms)
        .forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }

                form.classList.add('was-validated')
            }, false)
        })
    })()

    var loginBtn = true;
    $(document).on("submit", "#login-form", function(event)
    {
        var form = $(this);
        event.preventDefault();

        if(loginBtn == true){
            $.ajax({
                url: '{base_url()}'+'login/authenticate-login',
                type: 'POST',
                dataType: "JSON",
                data: new FormData(this),
                processData: false,
                contentType: false,
                beforeSend: function(){
                    loginBtn = false;
                    $(".btn-login-submit").html('<div class="spinner-border text-light" role="status"><span class="visually-hidden"></span></div>');
                    $(".error-login").html('');
                },
                complete: function (response, status)
                {
                    $(".btn-login-submit").html('{lang('button_login')}');
                },
                success: function (response, status)
                {
                    loginBtn = true;
                    if(response.status){
                      window.location = response.location;
                  }else{
                    $(".error-login").html(response.msg);
                } 
            },
            error: function (xhr, desc, err)
            {
                loginBtn = true;
                alert(desc);
            }
        });
        }
    });
</script>
{/block}

