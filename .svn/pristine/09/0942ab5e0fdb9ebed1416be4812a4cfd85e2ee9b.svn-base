{extends file="layout/base.tpl"}
{block name="header"}

<link rel="stylesheet" type="text/css" href="{assets_url()}theme/css/datatables.css">
<link href="{assets_url()}plugins/select2/select2.min.css" rel="stylesheet" />

<link href="{assets_url()}plugins/DataTables/datatables.min.css" rel="stylesheet" />
<link href="{assets_url()}plugins/DataTables/DataTables-1.12.1/css/buttons.dataTables.min.css" rel="stylesheet" />

{/block}
{block name="body"}
<div class="row "> 
  <div class="col-sm-12 hidden-print"> 
    <div class="card"> 
      <div class="card-header">
        <h5>Users</h5>
      </div>
      <div class="card-content">
        <div class="card-body"> 
          {form_open('','')}
          <div class="form-body">
            <div class="row">

              <div class="col-sm-3">
                <div class="form-group">

                  <label for="from_date">From Date</label>

                  <input class="form-control" type="date"  id="from_date" name="from_date" value="{$post_arr['from_date']}">

                </div>
              </div>
              <div class="col-sm-3">
                <div class="form-group">

                  <label for="end_date">End Date</label>

                  <input class="form-control" type="date" id="end_date" name="end_date" value="{$post_arr['end_date']}">

                </div>
              </div>

              <div class="col-sm-3">
                <div class="form-group">
                  <label for="user_name" class="control-label">{lang('username')}</label>
                  <select name="user_name" id="user_name" class="form-control user_name_ajax" {set_select('user_name', set_value('user_name'))}>
                   {if $post_arr['user_name']}
                   <option value="{$post_arr['user_name']}" selected>{$post_arr['user_names']}</option>
                   {/if} 
                 </select>

               </div>
             </div>


             <div class="col-sm-3">
              <div class="form-group">

                <label for="fullname">Full Name</label>

                <select class="form-control  full_user_ajax" name="full_user" id="full_user" {set_select('full_name', set_value('full_user'))}>

                  {if $post_arr['full_user']}
                  <option value="{$post_arr['full_user']}" selected>{$post_arr['full_user']}</option>
                  {/if}

                </select> 

              </div>
            </div> 

            <div class="col-sm-12"> 
              <button type="submit" class="btn btn-primary" name="submit" value="search">
                <i class="fa fa-filter"></i> FILTER
              </button>
              <button type="reset" class="btn btn-warning " name="reset" value="">
                <i class="fa fa-refresh"></i> RESET
              </button> 
            </div>
          </div>
        </div>
        {form_close()} 

      </div>
    </div>
  </div> 
</div> 
</div> 

<div class="page-wrapper compact-wrapper" id="pageWrapper">
  <div class="page-body-wrapper sidebar-icon"> 
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-12">
          <div class="card">
            <div class="card-header">
              <h5>Order Details : {$order_status}</h5>
            </div>
            <div class="card-body">
              <div class="dt-ext table-responsive">
                <table class="table color-table primary-table" id="new-cons">
                  <thead>
                    <tr>
                      <th>Transaction ID</th>
                      {* <th>USER NAME</th> *}
                      <th>FULL NAME</th>
                      <th>CONFIRM DATE</th>
                      <th>ORDER DATE</th>
                      <th>ORDER STATUS</th>
                      {* <th>UTR Number</th> *}
                      {* <th>Product Name</th> *}
                      <th>Payment Proof</th>
                      <th>AMOUNT</th>
                      {* <th>BV</th> *}
                      <th>INVOICE</th>
                      <th>DELIVERY PROOF</th>
                    </tr>
                  </thead>
                  {*<tbody>
                    {foreach $order_details as $v}
                    <tr>
                      <td>{$v.transaction_no}</td>
                      <td>{$v.user_name}</td>
                      <td>{$v.full_name}</td>
                      <td>{$v.order_date}</td>
                      <td>{$v.dates}</td>
                      <td>{$v.order_status}  <a class="btn btn-success btn-xs change_order_status" data-order-id="{$v.id}">
                        <i class="fa fa-edit"></i>
                      </a></td>
                      {if $v.order_status == 'Pending'}
                      <td>{$v.utr}</td>
                      {/if}
                      {if $order_status == 'Pending' || $order_status == 'Delivered'}
                      <td class="text-center"><a href="{assets_url()}uploads/payment_proof/{$v.payment_proof}"  title="Show Proof" target="new">Proof</a></td>
                      {/if}
                      <td>{cur_format($v.total_amount)}</td>
                      <td>{$v.total_point}</td>
                      <td><a href = "{base_url()}{log_user_type()}/inventory/order-invoice/{$v.encrypt_id}" class="btn btn-light" data-placement="top" data-original-title = "Invoice" target=" ">
                        <i class="fa fa-print fa fa-white" aria-hidden="true"></i>
                      </a> </td>
                      <td> <a class="btn btn-success btn-xs change_order_upload" data-order-id="{$v.id}"> <i class="fa fa-upload fa fa-white" aria-hidden="true"></i></a></td>
                    </tr>
                    {/foreach}

                  </tbody>*}

                </table>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div> 


<div class="modal fade" id="order_status_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Change Order Status</h5>
        <button class="close" type="button" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body">
       {form_open('admin/inventory/update_order_status','id="comission_form" name="comission_form" class="form-login"')}
       <input type="hidden" id="order_id" name="order_id" value="">
       <input type="hidden" id="current_status" name="current_status" value="{$order_status}">
       <div class="form-group">
        <label class="col-form-label" for="recipient-name">Select Status:</label>
        <select name="order_status" id="order_status" class="form-control" >

          <option value="Pending" {if $order_status=="Pending"} selected="" {/if}>Pending</option>
          <option value="Processing" {if $order_status=="Processing"} selected="" {/if}>Processing</option>
          <option value="Dispatched" {if $order_status=="Dispatched"} selected="" {/if}>Dispatched</option>
          <option value="Shipped" {if $order_status=="Shipped"} selected="" {/if}>Shipped</option>
          <option value="Delivered" {if $order_status=="Delivered"} selected="" {/if}>Delivered</option>

        </select>
      </div>

    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
      <button type="submit" name="update" id="update" value="update" class="btn btn-primary">Update</button>
    </div>
    {form_close()}
  </div>
</div>
</div>


<div class="modal fade" id="order_upload_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Upload Delivery Proof</h5>
        <button class="close" type="button" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body">
       {form_open_multipart('admin/inventory/update_order_proof','id="comission_form" name="comission_form" class="form-login"')}


       <div class="form-group bmd-form-group">
        <label class="bmd-label-floating">Comment</label>
        <textarea type="comment" class="form-control" name="comment" value="" ></textarea> 
      </div>
      <input type="hidden" id="order" name="order" value="">
      <div class="form-group">
        <label class="col-form-label" for="recipient-name">Proof</label>
        <input class="form-control" type="file" name="image1">
      </div>

    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
      <button type="submit" name="update" id="update" value="update" class="btn btn-primary">Upload</button>
    </div>
    {form_close()}
  </div>
</div>
</div>


{/block}
{block name="footer"}
<!-- Plugins JS start-->
<script src="{assets_url()}plugins/DataTables/datatables.min.js"></script>
<script src="{assets_url('plugins/DataTables/media/js/jquery.dataTables.min.js')}"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/dataTables.buttons.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/jszip.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/pdfmake.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/vfs_fonts.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/buttons.html5.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/buttons.print.min.js"></script>
<script src="{assets_url()}plugins/select2/select2.min.js"></script>
{* <script type="text/javascript">
  $('.user_name_ajax').select2({
      placeholder:'{lang('select_a_user')}',
      ajax: {
        url: '{base_url()}admin/autocomplete/getUser_ajax',
        type:'post',
        dataType: 'json',
        delay: 250,
        processResults: function (data) { 
          return {
            results: data
          };

        },
        cache: true
      }

    }); 

  </script> *}

  <script type="text/javascript">

    $(document).ready(function(){

      var order = $('#new-cons').DataTable({
        responsive: true,
        "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]],
        'processing': true,
        'serverSide': true,
        "autoWidth": false,
        'serverMethod': 'post',
        "pagingType": "simple_numbers",  
        "sortable": true,
        "aaSorting": [],
        "order": [],
        "aoColumnDefs": [
          { "bSortable": false, "aTargets": [0,1,2,3,4,5,6,7,8] },
          ],

        "columnDefs": [{
          "targets": 'no-sort',
          "orderable": false,

        }],

        'ajax': {
          'url':'{base_url()}admin/inventory/order_management_ajax',
          "type": "POST",
          "data" : {

            'from_date' : '{$post_arr['from_date']}',
            'end_date' : '{$post_arr['end_date']}',
            'order_status' : '{$post_arr['order_status']}',
            'user_id' : '{$post_arr['user_name']}',
            'user_ids' : '{$post_arr['full_user']}',
          }

        },
        'columns': [
          { data: 'transaction_no' },
        // { data: 'user_name'},
          { data: 'full_name'},
          { data: 'date' },
          { data: 'order_date' },
          { data: 'status', mRender: function(data, type, row) {
            var html =  row.status+'<a class="btn btn-success btn-xs change_order_status"  data-order-id="'+row.order_id+'"><i class="fa fa-edit"></i></a>' ;
            return html;
          }},
        // { data: 'utr'},
        // { data: 'product_namesz'},
          { data: 'payment_proof', mRender: function(data, type, row) {
            var html =  '<td class="text-center"><a href="{assets_url()}uploads/payment_proof/'+row.payment_proof+'"  title="Show Proof" target="new">Proof</a></td>' ;
            return html;
          }},
          { data: 'cur_total_amount'},
        // { data: 'total_point'},
          { data: 'encrypt_id', mRender: function(data, type, row) {
            var html =  '<a href = "{base_url()}{log_user_type()}/inventory/order-invoice/'+row.encrypt_id+'" class="btn btn-light" data-placement="top" data-original-title = "Invoice" target=" "><i class="fa fa-print fa fa-white" aria-hidden="true"></i></a>' ;
            return html;
          }},
          { data: 'id', mRender: function(data, type, row) {
            var html =  '<a class="btn btn-success btn-xs change_order_upload" data-order-id="'+row.order_id+'"> <i class="fa fa-upload fa fa-white" aria-hidden="true"></i></a>' ;
            return html;
          }},
          ],
        success: function(response) { 
        } 
      });  
    }); 

  </script>

  <script type="text/javascript">

    jQuery(document).ready(function() {

      $('#new-cons tbody').on('click', '.change_order_status', function () {

        var id = $(this).attr('data-order-id');
        console.log(id);
        $("#order_id").val(id);

      // $('#order_status_modal').modal();
        var myModal = new bootstrap.Modal(document.getElementById('order_status_modal'))
        myModal.show()
      });

      $('#new-cons tbody').on('click', '.change_order_upload', function () {

        var id = $(this).attr('data-order-id');
        console.log(id);
        $("#order").val(id);
      // $('#order_upload_modal').modal();
        var uploadModal = new bootstrap.Modal(document.getElementById('order_upload_modal'))
        uploadModal.show()
      });
    });


    $('.user_name_ajax').select2({
      placeholder:'{lang('select_a_user')}',
      ajax: {
        url: '{base_url()}admin/autocomplete/getUser_ajax',
        type:'post',
        dataType: 'json',
        delay: 250,
        processResults: function (data) { 
          return {
            results: data
          };

        },
        cache: true
      }

    }); 


    $('.full_user_ajax').select2({

    placeholder: '{lang('username')}',
    ajax: {
      url: '{base_url()}admin/autocomplete/order_full_user',
      type:'post',
      dataType: 'json',
      delay: 250,
      processResults: function (data) { 
        return {
          results: data
        };

      },
      cache: true
    }

  }); 




  </script>



  {/block}
