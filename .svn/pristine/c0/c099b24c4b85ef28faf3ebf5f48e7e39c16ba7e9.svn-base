{extends file="layout/base.tpl"}
{block name="header"}
<link href="{assets_url('css/select2.css')}" rel="stylesheet" /> 
<link rel="stylesheet" type="text/css" href="{assets_url('plugins/sweetalert/lib/sweet-alert.css')}">
<link href="{assets_url()}plugins/DataTables/datatables.min.css" rel="stylesheet" />
<link href="{assets_url()}plugins/DataTables/DataTables-1.12.1/css/buttons.dataTables.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="{assets_url('plugins/sweetalert/lib/sweet-alert.css')}">
<link href="{assets_url()}plugins/select2/select2.min.css" rel="stylesheet" />
<link href="{assets_url()}plugins/notify/notify.css" rel="stylesheet" /> 
{/block}
{block body}   
<div class="col-sm-12">
    <div class="card">
        <div class="card-header">
            <h5>KYC APPROVAL</h5>
        </div>
        {form_open('','')}
        <div class="card-body">
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label for="user_id" class="control-label">Status</label>
                        <select name="status" id="status" class="form-control" >
                            <option value="pending"{if $post_arr['status']=='pending'}selected{/if} selected>Pending</option>
                            <option value="approved" {if $post_arr['status']=='approved'}selected{/if}>Approved</option>
                            <option value="deleted" {if $post_arr['status']=='deleted'}selected{/if}>Deleted</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-12 mt-3"> 
                    <button type="submit" class="btn btn-primary" name="submit" id="searchbtn" value="search">
                        <i class="fa fa-filter"></i> Filter
                    </button>
                    <button type="submit" class="btn btn-warning mr-1" name="submit" id="clearbtn" value="reset">
                        <i class="fa fa-refresh"></i> Reset
                    </button> 
                </div>
            </div>
        </div>
    </div>
    {form_close()}
</div>
<div class="row "> 
 <div class="col-sm-12"> 
    <div class="card"> 
       <div class="card-header">
          <h5>KYC APPROVAL</h5>
      </div>
      <div class="card-content">
          <div class="card-body">  

             <div class="table-responsive">
                <table class="table color-table primary-table" id="exportTable">
                   <thead >
                      <tr>
                         <th >#</th>
                         <th >User ID</th>
                         <th >NAME</th>
                         <th>Account No:</th>
                         <th>Aadhar No:</th>
                         <th>Pan card No:</th>
                         <th>Pancard</th>
                         <th>Account Passbook</th>
                         <th>Date</th>
                         <th>Status</th>  
                     </tr>
                 </thead>
             </table>
         </div>
     </div>
 </div>
</div> 
</div> 
</div> 
{/block}


{block name="footer"}
<script src="{assets_url('plugins/sweetalert/lib/sweet-alert.min.js')}"></script>
<script src="{assets_url()}plugins/DataTables/datatables.min.js"></script>
<script src="{assets_url('plugins/DataTables/DataTables-1.12.1/js/jquery.dataTables.min.js')}"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/dataTables.buttons.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/jszip.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/pdfmake.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/vfs_fonts.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/buttons.html5.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/buttons.print.min.js"></script>
<script src="{assets_url('plugins/sweetalert/lib/sweet-alert.min.js')}"></script>
<script src="{assets_url()}plugins/select2/select2.min.js"></script>
<script src="{assets_url()}plugins/notify/notify.js"></script>
<script>
 function delete_req(id)
 {
    swal({
      title: 'Are you sure?',
      text: 'Do you want to reject',
      type: "warning",
      showCancelButton: true,
      confirmButtonColor: "#DD6B55",
      confirmButtonText: 'Delete it',
      cancelButtonText: 'Cancel Please',
      closeOnConfirm: false,
      closeOnCancel: false,
  },
  function (isConfirm) {
      if (isConfirm) {
        $(".confirm").hide();
        $(".cancel").hide();
        $("<div class='spinner'></div>").append('<div id="gif" style="display: block; margin: 0 auto; visibility: visible;" class="spinner-border"></div>');
        document.location.href ="{base_url()}admin/member/kyc/delete/"+id; 
    } else {
        swal('Cancelled', 'Data Safe', "error");
    }
});

}

function approve_req(id)
{
    swal({
      title: 'Are you sure?',
      text: 'Do you want to approve',
      type: "warning",
      showCancelButton: true,
      confirmButtonColor: "#DD6B55",
      confirmButtonText: 'Approve it',
      cancelButtonText: 'Cancel Please',
      closeOnConfirm: false,
      closeOnCancel: false,
  },
  function (isConfirm) {
      if (isConfirm) {
        $(".confirm").hide();
        $(".cancel").hide();
        $("<div class='spinner'></div>").append('<div id="gif" style="display: block; margin: 0 auto; visibility: visible;" class="spinner-border"></div>');
        document.location.href ="{base_url()}admin/member/kyc/approve/"+id; 
    } else {
        swal('Cancelled', 'Data Safe', "error");
    }
});

}
</script>


<script type="text/javascript">
    $(document).ready(function() {
        $('#ingredients').summernote();
    });
    $(document).ready(function() {
        $('#ingredients_edit').summernote();
    });
    $(document).ready(function(){
        var order = $('#exportTable').DataTable({
            dom: 'Bfrtip',
            lengthMenu: [
                [10, 50, 100,200,500,1000, {$count}],
                [10, 50, 100,200,500,1000, 'All'],
                ],
            buttons: [
                'pageLength', 'copy', 'csv', 'pdf', 'print',{
                    extend: 'excelHtml5',
                    title: 'Transaction',
                    customizeData: function(data) {
                        for(var i = 0; i < data.body.length; i++) {
                            for(var j = 0; j < data.body[i].length; j++) {
                                data.body[i][j] = '\u200C' + data.body[i][j];
                            }
                        }
                    },      
                    orientation: 'landscape'
                }],
            'processing': true,
            'serverSide': true,
            "autoWidth": false,
            'serverMethod': 'post', 
            "pagingType": "full_numbers",
            "pageLength": 10,
            "sortable": true,
            "pagingType": "full_numbers",

            "aaSorting": [],
            "order": [],


            "columnDefs": [{
                "targets": [ 0, 1, 2,3 ,4 ,5 ,6 ,7 ,8,9
                    ], 
                "orderable": false, 
                "className": "no-sort" 
            }],
            'ajax': {
                'url':'{base_url()}admin/member/get_kyc_ajax',
                "type": "POST",
                "data" : {
                    'status' : '{$post_arr['status']}',
                }
            },
            'columns': [
               { data: 'index' },
               { data: 'user_name' },
               { data: 'full_name' },
               { data: 'account_no'},
               { data: 'aadhaar_no'},
               { data: 'pan_no' },
               { data: 'userfile', mRender: function(data, type, row) {
                var link = '<div class="flag" style="width: 100%;"><a target="_blank" href="{assets_url()}uploads/passbook/'+row.userfile+'"><img src="{assets_url()}uploads/passbook/'+row.userfile+'" class="img-thumbnail" alt="Product image"style="max-width: 47px;"></a></div>';
                return link;
            }},
            { data: 'passbook', mRender: function(data, type, row) {
                var link = '<div class="flag" style="width: 100%;"><a target="_blank" href="{assets_url()}uploads/passbook/'+row.passbook+'"><img src="{assets_url()}uploads/passbook/'+row.passbook+'" class="img-thumbnail" alt="Product image"style="max-width: 47px;"><a></div>';
                return link;
            }},
            { data: 'added_date' },
            { data: 'id', mRender: function(data, type, row) {
                var  link= '<div class="btn-group" role="group" aria-label="Action">'
                if(row.status=='pending'){
                    link +=" <a href='javascript:approve_req("+row.id+")' class='btn btn-success'><i class='fa fa-check'></i>  </a>";
                    link +="<a href='javascript:delete_req("+row.id+") ' class='btn btn-danger'> <i class='fa fa-trash'></i></a>";
                }else{
                    link += capitalizeFirstLetter(row.status);
                }
                link += '</div>';
                return link;
            }}, 
            ],
            success: function(response) { 
            } 
        });  
        $(document).on("click", ".delete_req", function(event){

            $.ajax({
                type:'POST',
                url:"{base_url('admin/member/delete_req')}",
                data: { product_id: $(this).data('delete_req')} ,
                dataType:'json',

            })
            .done(function( response ) {  
                if(response.status){
                    toastr.error('Error On Kyc Approving',{ progressBar:!0 })
                    order.ajax.reload(null, false );
                }else{
                    toastr.error(response.msg, "error: ",{ progressBar:!0 })

                }

            }); 

        }); 
        $(document).on("click", ".approve_req", function(event){
            $.ajax({
                type:'POST',
                url:"{base_url('admin/member/approve_req')}",
                data: { product_id: $(this).data('approve_req')} ,
                dataType:'json',

            })
            .done(function( response ) {  
                if(response.status){
                    toastr.success("kYC Approved Successfully",{ progressBar:!0 })
                    order.ajax.reload(null, false );
                }else{
                    toastr.error(response.msg, "error: ",{ progressBar:!0 })

                }
            }); 
        }); 
    });
function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
    }
</script>
{/block}