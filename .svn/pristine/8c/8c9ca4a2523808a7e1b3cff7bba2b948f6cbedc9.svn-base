{extends file="layout/base.tpl"}
{block name="head"} 
<link href="{assets_url()}backend/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet" />

<link rel="stylesheet" type="text/css" href="{assets_url('plugins/newselect2/select2.min.css')}">
<link href="{assets_url()}plugins/DataTabless/datatables.min.css" rel="stylesheet" />
<link href="{assets_url()}plugins/DataTabless/DataTables-1.12.1/css/buttons.dataTables.min.css" rel="stylesheet" />


<style>
	#link{
		color: green !important;
		background-color: transparent;
		text-decoration: none;
	}

</style>
{/block}
{block name="body"} 
<input type="hidden" id="logType" value="{log_user_type()}">
<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
	<div class="card">
		
		{form_open('','id="search_ticket" name="search_ticket"')}
		<div class="card-header card-header-text" data-background-color="rose">
			<h6 class="card-title">{lang('text_ticket_search')}</h6>
		</div>
		<div class="card-body">
			<div class="row">
				<div class="col-sm-4 checkbox-radios">
					<legend>{lang('text_statuses')}</legend>
					{foreach from=$status_arr item=statuses}
					<div class="checkbox">
						<label>
							{form_checkbox('status_ids[]', {$statuses.id},  set_checkbox('status_ids[]', {$statuses.id}))}
							{$statuses.name}
						</label>
					</div>
					{/foreach}
				</div>
				<div class="col-sm-4 checkbox-radios">
					<legend>{lang('text_priority')}</legend>
					{foreach from=$priority_arr item=priorities}
					<div class="checkbox">
						<label>
							{form_checkbox('priority_ids[]', {$priorities.id},  set_checkbox('priority_ids[]', {$priorities.id}))}
							{$priorities.name}
						</label>
					</div>
					{/foreach}
				</div>
				<div class="col-sm-4 checkbox-radios">
					<legend>{lang('text_help_topic')}</legend>
					{foreach from=$topic_arr item=topics}
					<div class="checkbox">
						<label>
							{form_checkbox('topic_ids[]', {$topics.id},  set_checkbox('topic_ids[]', {$topics.id}))}
							{$topics.name}
						</label>
					</div>
					{/foreach}
				</div>
			</div>
			<div class="row">
				<div class="col-md-3">
					<div class="form-group">
						<!-- <select name="user_name" id="user_name" class="form-control user_name_ajax" {set_select('user_name', set_value('user_name'))} >
							{if $user_name}
							<option value="{$user_name}" selected>{$user_name}</option>
							{/if}
						</select> -->
						<input type="text" name="user_name" id="user_name" class="form-control" placeholder="User Name" value="{set_value('user_name')}">
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-group">
						<input type="text" class="form-control" name="ticket_name" placeholder="{lang('text_ticket_id')}" value="{set_value('ticket_name')}">
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-group">
						<input type="date" class="form-control " placeholder="{lang('text_start_date')}" name="start_date" id="start_date" value={$post_arr['start_date']}>
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-group">
						<input type="date" class="form-control " placeholder="{lang('text_end_date')}"name="end_date" id="end_date" value="{$post_arr['end_date']}">
					</div>
				</div>
				<div class="col-sm-1">
					<div class="form-group form-button  pull-right">
						<button type="submit" class="btn btn-outline-primary" name="search" value="search" style="margin-top:10px">{lang('text_search')}</button>
					</div>
				</div>
			</div>
		</div>
		{form_close()}
		<div class="card-arrow">
			<div class="card-arrow-top-left"></div>
			<div class="card-arrow-top-right"></div>
			<div class="card-arrow-bottom-left"></div>
			<div class="card-arrow-bottom-right"></div>
		</div>
	</div>
</div><br>

<div class="row">
	<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
		<div class="card">

			<div class="card-body">
				<h6 class="card-title">{lang('text_my_tickets')} </h6>
				{if $searched_tags}
				<div class="well row margin-top-5">
					<h4  class="col-xs-2">{lang('text_searched_tags')} :</h4>
					<div class="col-md-6">
						<div class="form-group ">				
							<textarea  class="tagsinput form-control" data-role="tagsinput" data-color="warning" readonly />{$searched_tags}</textarea>
							{* <input type="text" value="{$searched_tags}" class="tagsinput" data-role="tagsinput" data-color="warning" readonly /> *}
						</div> 
					</div>
					{/if}
					<div class="table-responsive row">
						<table class="table table-striped" id="exportTable">
							<thead>
								<tr>
									<th></th>
									<th class="text-center">#</th>
									<th>{lang('text_user_name')}</th>
									<th>{lang('text_ticket_id')}</th>
									<th>{lang('text_full_name')}</th>
									<th>{lang('text_subject')}</th>
									<th>{lang('text_status')}</th>
									<th>{lang('text_priority')}</th>
									<th>{lang('text_help_topic')}</th>
									<th>{lang('text_image')}</th>
									<th>{lang('text_last_activity')}</th>  
								</tr>
							</thead>
							<tbody>
								{if count($ticket_arr) > 0}
								{foreach from=$ticket_arr item=tk }
								<tr>
									<td>
										<div class="checkbox">
											<label>
												<input type="checkbox" name="ticket_ids[]" class="ticketIds" value="{$tk.ticket_id}" >
											</label>
										</div>
									</td>
									<td class="text-center">{counter}</td>
									<td>{$tk.user_name}</td>
									<td>#<a href="{base_url()}{log_user_type()}/support/ticket_details?ticket_id={$tk.enc_id}" id="link" target="_blank"> {$tk.name} </a></td>
									<td>{$tk.full_name}</td>
									<td>{$tk.subject}</td>
									<td>{$tk.status_name}</td>
									<td>{$tk.priority_name}</td>
									<td>{$tk.topic_name}</td>
									{if $tk.img}
									<td>
                                        <a href ="{assets_url()}uploads/efiles/{$tk.img}"target="_blank" class="text-primary">View image</a>
                                    </td>
                                    {else}
                                    <td></td>
                                    {/if}
									<td>{$tk.last_updated|date_format:"%d/%m/%Y  %H:%M  %p"}</td>
								</tr>
								{/foreach}
								{else}
								<tr>	
									<th colspan="12">
										<h6 class="text-center"><i class="fa fa-exclamation"></i> {lang('text_no_transfer_details_found')}</h6>
									</th>
								</tr>
								{/if}
							</tbody>
						</table>
						
					</div>
					<div class="row">
						<div class="col-sm-4 pt-3">
							<div class="pull-left">


								<div class="dropdown">
									<button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
										{lang('text_change_status')} 
									</button>
									<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
										{foreach from=$status_arr item=statuses}
										<a href="#" class="dropdown-item change-status" data-val="{$statuses.id}">{$statuses.name}</a>
										{/foreach}
									</div>
								</div>

							</div>
						</div>
						{* <div class="col-sm-4 pt-3">
							<div class="pull-left">
								


								<div class="dropdown">
									<button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										Change Priority 
									</button>
									<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
										{foreach from=$priority_arr item=priority}
										<a href="#" class="dropdown-item change-priority" data-val="{$priority.id}">{$priority.name}</a>
										{/foreach}
									</div>
								</div>
							</div>
						</div> *}
						{* <div class="col-sm-4 pt-3">
							<div class="pull-left">
								<div class="dropdown">
									<button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										Change Topic
									</button>
									<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
										{foreach from=$topic_arr item=topic}
										<a href="#" class="dropdown-item change-topic" data-val="{$topic.id}">{$topic.name}</a>
										{/foreach}
									</div>
								</div>
							</div>
						</div> *}
					</div>
				</div>
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
			</div>
		</div>
	</div>

	{/block}
	{block name="footer"}
	<script src="{assets_url('plugins/support/main.js')}"></script>
	<script src="{assets_url('support/js/pages.js')}"></script>
	<script src="{assets_url('plugins/support/moment.min.js')}"></script>
	<script src="{assets_url('plugins/support/bootstrap-datetimepicker.js')}"></script>
	<script src="{assets_url('support/js/sweetalert2.js')}"></script>
	<script src="{assets_url('plugins/newselect2/select2.min.js')}"></script> 


	<script src="{assets_url('support/js/moment.min.js')}"></script>
	<script src="{assets_url('support/js/bootstrap-datetimepicker.js')}"></script>
	<script src="{assets_url('support/js/bootstrap-notify.js')}"></script>
	<script src="{assets_url('support/js/sweetalert2.js')}"></script>
	<script src="{assets_url('support/js/jquery.tagsinput.js')}"></script>
	<script src="{assets_url('support/js/pages.js')}"></script>





	<script src="{assets_url('plugins/DataTables/media/js/jquery.dataTables.min.js')}"></script> 

	<script src="{assets_url()}plugins/DataTabless/datatables.min.js"></script>
	<script src="{assets_url('plugins/DataTables/media/js/jquery.dataTables.min.js')}"></script>
	<script src="{assets_url()}plugins/DataTabless/DataTables-1.12.1/js/dataTables.buttons.min.js"></script>
	<script src="{assets_url()}plugins/DataTabless/DataTables-1.12.1/js/jszip.min.js"></script>
	<script src="{assets_url()}plugins/DataTabless/DataTables-1.12.1/js/pdfmake.min.js"></script>
	<script src="{assets_url()}plugins/DataTabless/DataTables-1.12.1/js/vfs_fonts.js"></script>
	<script src="{assets_url()}plugins/DataTabless/DataTables-1.12.1/js/buttons.html5.min.js"></script>
	<script src="{assets_url()}plugins/DataTabless/DataTables-1.12.1/js/buttons.print.min.js"></script>

	<script type="text/javascript">
		
		// $(document).ready(function(){
		// alert("adas");
		$('.user_name_ajax').select2({

			placeholder: 'Select a user',
			ajax: {
				url: '{base_url()}admin/autocomplete/getUser_ajax',
				type:'post',
				dataType: 'json',
				delay: 250,
				processResults: function (data) { 
					return {
						results: data
					};
				},
				cache: true
			}

		}); 
	// });
	</script>

	<script type="text/javascript">
		$(document).ready(function() {


			Ticket.changeTicketStatus();
			// Ticket1.changeTicketPriority();
			// Ticket2.changeTicketHelpTopic();
		});


	</script>

	<script type="text/javascript">
		$('#start_date').datepicker({
			autoclose: true
		});
		$('#end_date').datepicker({
			autoclose: true
		});
	</script>

	<script type="text/javascript">

		$(document).ready(function(){
			var order = $('#exportTable').DataTable({
				dom: 'Bfrtip',
				lengthMenu: [
					[10, 50, 100,200,500,1000, {$count}],
					[10, 50, 100,200,500,1000, 'All'],
					],
				buttons: [
					'pageLength', 'copy', 'csv', 'pdf', 'print',{
						extend: 'excelHtml5',
						title: 'Transaction',
						customizeData: function(data) {
							for(var i = 0; i < data.body.length; i++) {
								for(var j = 0; j < data.body[i].length; j++) {
									data.body[i][j] = '\u200C' + data.body[i][j];
								}
							}
						},      
						orientation: 'landscape'
					}],
			});
		});
	</script>

	{/block}
