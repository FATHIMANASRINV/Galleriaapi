{extends file="layout/base.tpl"}
{block name="header"}
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.snow.css">
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.bubble.css">
<style type="text/css">
    .mobile {
      display: none;
}
@media (max-width: 360px) {
  .mobile {
    display: block;
  }
}
</style>
{/block}
{block name="body"}

<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-header border-light">
                <h5>
                    <i class="fa fa-upload fa-lg blue-color" ></i>
                    {lang('text_upload_efiles')}
                   
                </h5>
                <br>
                 <a  class="btn btn-primary" href="{base_url()}admin/tools/view-efiles" >{lang('view')}</a>

                {* <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                    </li> 
                    <li><a class="close-link"><i class="fa fa-close"></i></a>
                    </li>
                </ul> *}

                <div class="clearfix"></div> 
            </div>
            <div class="card-body">

                {form_open_multipart('','id="file_form" name="file_form" class="form-login needs-validation" enctype="multipart/form-data" novalidate=""')}

                <div class="form-group">
                    <label class="control-label">
                        {lang('text_efile_title')}<span class="symbol required"></span>
                    </label>
                    <div class="controls">
                        <input type="text" class="form-control" id="doc_title" name="title" value="{set_value('doc_title')}" required>
                        <div class="invalid-feedback">{lang('efile_title_is')}</div>

                        {form_error("title")}
                    </div>
                </div>

                  <div class="form-group">
                   <label class="form-label">{lang('text_efile_description')}</label> 
                    <div class="controls">
                        <div id="editor"></div>
                        <textarea cols="50" rows="5" class="form-control d-none"  name='content' id='content' required></textarea>
                        {form_error("content")}
                    </div>
                </div>
 


              {*   <div class="form-group">
                    <label class="control-label">
                        {lang('text_efile_description')}<span class="symbol required"></span>
                    </label>
                    <div class="controls">
                        <textarea cols="50" rows="5" class="tinymce d-none" name="content"  ></textarea>
                        {form_error("content")}
                    </div>
                </div>
 *}
                <div class="col-md-6">
                    <label class="form-label">{lang('attachment')}</label><br>                                     
                    <a href="" id="thumb-image" data-toggle="image" class="img-thumbnail" style="height: 180px; max-width: 200px;">
                        <div class="fileupload-preview thumbnail border" style="width: 200px; height: 180px;  ">

                            <img src="" id="image" name="image" alt="" title="" data-placeholder="" width="200" height="180">

                            <input type="hidden" name="image" value="{$image}" id="input-image"/>

                        </div>
                    </a>


                </div>




                <br>

                <div class="form-group">
                    <button class="btn btn-primary" type="submit" id="efile_upload" name="efile_upload" value="efile_upload">
                        {lang('text_uplaod')} <i class="fa fa-arrow-circle-right"></i>
                    </button>
                </div>
                {form_close()}

            </div>
        </div>
    </div>
</div>


 {* <div class="modal fade" id="scrollinglongcontent" data-keyboard="false" tabindex="-1" aria-labelledby="scrollinglongcontentLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="scrollinglongcontentLabel">{lang('modal_title222')}</h5>
        <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body modal-dialog modal-dialog-scrollable mt-0">
        
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">{lang('close')}</button>
        <button class="btn btn-primary" type="button">{lang('understood')}</button>
      </div>
    </div>
  </div>
</div>
*}
<br class="mobile" />
<br class="mobile" />
<br class="mobile" />
<br class="mobile" />
{/block}
{block name="footer"}
{*<script src="{assets_url('plugins/ckeditor/ckeditor.js')}"></script>*}
{* <script src="{assets_url('plugins/ckeditor/adapters/jquery.js')}"></script> *}
<script src="{assets_url()}backend/vendors/tinymce/tinymce.min.js"></script>
<script src="{assets_url('plugins/datepicker/zebra_datepicker.min.js')}"></script>
<script src="{assets_url()}backend/vendors/tinymce/tinymce.min.js"></script>
<script src="{assets_url()}backend/js/quill-editor.js"></script>
<script src="{assets_url()}backend/libs/quill/quill.min.js"></script>
<script src="{assets_url()}backend/js/quill-editor.js"></script>

<script>
    $(document).on('click', 'a[data-toggle=\'image\']', function(e) 
    {

        var $element = $(this);

        var $popover = $element.data('bs.popover'); // element has bs popover?


        e.preventDefault();


        $('a[data-toggle="image"]').popover('dispose');
        
        if ($popover) {
            return;
        }

        $element.popover({
            html: true,
            placement: 'right',
            // trigger: 'manual',
            content: function() {
                return '<a class="btn btn-falcon-primary me-1 mb-1" type="button" id="button-image" >Edit</a><a class="btn btn-falcon-primary me-1 mb-1" type="button" id="button-clear" >Clear</a>';

            }
        });


        $element.popover('show');

        $('#button-image').on('click', function() {
            var $button = $(this);
            var $icon   = $button.find('> i');
            var $thumb = $element.attr('id');
            var $target = $element.parent().find('input').attr('id');
            $('#modal-image').remove();

            $.ajax({
                url: '{{base_url()}}admin/tools/get_image_gallery_ajax/efile_images?target=' + $target + '&thumb=' + $thumb,
                dataType: 'html',
                beforeSend: function() {
                    $button.prop('disabled', true);
                    if ($icon.length) {
                        $icon.attr('class', 'fa fa-circle-o-notch fa-spin');
                    }
                },
                complete: function() {
                    $button.prop('disabled', false);

                    if ($icon.length) {
                        $icon.attr('class', 'fa fa-pencil');
                    }

                } ,
                success: function(html) {
                    console.log(html);

                    $('body ').append('<div id="modal-image" class="modal">' + html + '</div>');
                    $('#modal-image').modal('show');
                    $('#modal-image').modal();



                }
            });


            $element.popover('dispose');
        });
        $('#button-clear').on('click', function() {
            $element.find('img').attr('src', '{{ img_placeholder }}');
            $element.parent().find('input').val('');
            $element.popover('dispose');
        });
    }); 
</script>
<script type="text/javascript">
   

    $("#file_form").on("submit",function(e) {
        var content = $(".ql-editor").html();
        if (content != '<p><br></p>') {
            $("#content").val(content);
        }
        
    });
</script>

{/block}