{extends file="layout/base.tpl"}

{block name="header"} 

<link href="{assets_url()}plugins/notify/notify.css" rel="stylesheet" /> 
<!-- Jsvector Maps -->
<link rel="stylesheet" href="{assets_url()}backend/libs/jsvectormap/css/jsvectormap.min.css">

{/block}
{block name="body"}  

{if $MAINTENANCE_MODE==1}
<div class="alert alert-danger border-2 d-flex align-items-center" role="alert">
	<div class="bg-danger me-3 icon-item"><span class="fas fa-exclamation-circle text-white fs-3"></span></div>
	<p class="mb-0 flex-1">{$MAINTENANCE_TEXT}</p>
	<a href="{base_url()}/admin/settings/site_info" class="btn btn-link col-sm-6" >{lang('maintenance_mode_update')} <i class="fa fa-arrow-circle-right"></i> </a>
	<button class="btn-close" type="button" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{/if}

<div class="row">
	<div class="col-lg-12 col-xxl-12">
		<div class="card bg-100 bg-warning-gradient shadow-none border">
			<div class="card-body position-relative">
				<div class="row g-2 align-items-sm-center">
					<div class="col-auto"><img src="{assets_url()}/images/icons/index.png" alt="" height="55" /></div>
					<div class="col">
						<div class="row align-items-center ">
							<label class="text-fixed-white">{lang('referral_link')}</label>
							<div class="col-sm-9 text-primary">

								<p class="text-fixed-white" id="post-shortlink">{base_url()}referral/{log_user_name()}</p>	  

							</div>
							<div class="col-sm-3 ">                   
								<div class="row align-items-center">

									<button class="btn btn-warning col-sm-6" id="copy-button" onclick="copyReferral('#post-shortlink')" data-clipboard-target="#post-shortlink" class="card-icon">{lang('copy')} <i class="fa fa-copy"></i></button>
									<a href="{base_url()}referral/{log_user_name()}" class="btn btn-link col-sm-6 text-white">{lang('go')} <i class="fa fa-arrow-circle-right"></i></a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- row -->
<div class="row">
	<div class="col-lg-6 col-xl-4 col-md-6 col-12">
		<div class="card bg-primary-gradient text-fixed-white ">
			<div class="card-body text-fixed-white">
				<div class="row">
					<div class="col-6">
						<div class="icon1 mt-2 text-center">
							<i class="fe fe-users fs-40"></i>
						</div>
					</div>
					<div class="col-6">
						<div class="mt-0 text-center">
							<span class="text-fixed-white">{lang('total_refferals')}</span>
							<h3 class="text-fixed-white mb-0">{$total_users}</h3>
						</div>
					</div>
				</div>
			</div>
			<div id="compositeline"></div>
		</div>
	</div>
	<div class="col-lg-6 col-xl-4 col-md-6 col-12">
		<div class="card bg-danger-gradient text-fixed-white ">
			<div class="card-body text-fixed-white">
				<div class="row">
					<div class="col-6">
						<div class="icon1 mt-2 text-center">
							<i class="fa fa-wallet fs-40"></i>
						</div>
					</div>
					<div class="col-6">
						<div class="mt-0 text-center">
							<span class="text-fixed-white">{lang('total_wallet')}</span>
							<h3 class="text-fixed-white mb-0">{cur_format($user_wallet['wallet'])}</h3>
						</div>
					</div>
				</div>
			</div>
			<div id="compositeline2"></div>
		</div>
	</div>

	<div class="col-lg-6 col-xl-4 col-md-6 col-12">
		<div class="card bg-success-gradient text-fixed-white ">
			<div class="card-body text-fixed-white">
				<div class="row">
					<div class="col-6">
						<div class="icon1 mt-2 text-center">
							<i class="fa fa-coins fs-40"></i>
						</div>
					</div>
					<div class="col-6">
						<div class="mt-0 text-center">
							<span class="text-fixed-white">ROI</span>
							<h3 class="text-fixed-white mb-0">{$roi}</h3>
						</div>
					</div>
				</div>
			</div>
			<div id="compositeline4"></div>
		</div>
	</div>

	<div class="col-sm-12 col-lg-6 col-xl-6">
		<div class="card card-img-holder">
			<div class="card-body list-icons p-0">
				<div class="clearfix px-4 pt-3">
					<div class="float-end  mt-2">
						<span class="text-primary ">
							<i class="far fa-clock fs-5"></i>
						</span>
					</div>
					<div class="float-start">
						<p class="card-text text-muted mb-1">{lang('local_time')}</p>
						<h4><span id="local-time"></span></h4>
					</div>
				</div>
				<div class="card-footer p-0">
					<p class="text-muted mb-0 px-4 p-3"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="col-sm-12 col-lg-6 col-xl-6">
		<div class="card card-img-holder">
			<div class="card-body list-icons p-0">
				<div class="clearfix px-4 pt-3">
					<div class="float-end  mt-2">
						<span class="text-primary ">
							<i class="far fa-clock fs-5"></i>
						</span>
					</div>
					<div class="float-start">
						<p class="card-text text-muted mb-1">{lang('server_time')}</p>
						<h4><span id="server-time"></span></h4>

					</div>
				</div>
				<div class="card-footer p-0">
					<p class="text-muted mb-0 px-4 p-3"></p>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- row closed -->

<!-- row -->
<div class="row">
	<div class="col-sm-12 col-lg-6">
		<div class="card">
			<div class="card-header pb-0">
				<div class="card-title pb-0 mb-2">Bonus</div>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col text-center">
						<label class="fs-12">{lang('referral_bonus')}</label>
						<p class="fw-bold fs-20">{cur_format($user_wallet['referral_bonus'])}</p>
					</div><!-- col -->
					<div class="col border-start text-center">
						<label class="fs-12">{lang('level_bonus')}</label>
						<p class="fw-bold fs-20">{cur_format($user_wallet['level_bonus'])}</p>
					</div><!-- col -->
					<div class="col border-start text-center">
						<label class="fs-12">{lang('rank_bonus')}</label>
						<p class="fw-bold fs-20">{cur_format($user_wallet['rank_bonus'])}</p>
					</div><!-- col -->
				</div><!-- Start::row-1 -->
				<div class="progress mb-3 ht-20 mt-3" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"> 
					<div class="progress-bar progress-bar-striped progress-bar-animated bg-primary ht-20" style="width: 100%"></div> 
				</div>
			</div>
		</div>
	</div>
	<div class="col-sm-12 col-lg-6">
		<div class="card">
			<div class="card-header pb-0">
				<div class="card-title pb-0 mb-2">Payout</div>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col text-center">
						<label class="fs-12">Total</label>
						<p class="fw-bold fs-20">{cur_format($payout_release+$payout_pending)}</p>
					</div><!-- col -->
					<div class="col border-start text-center ">
						<label class="fs-12">Released</label>
						<p class="fw-bold fs-20">{cur_format($payout_release)}</p>
					</div><!-- col -->
					<div class="col border-start text-center">
						<label class="fs-12">Pending</label>
						<p class="fw-bold fs-20">{cur_format($payout_pending)}</p>
					</div><!-- col -->
				</div><!-- Start::row-1 -->
				<div class="progress mb-3 ht-20 mt-3" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"> 
					<div class="progress-bar progress-bar-striped progress-bar-animated bg-success ht-20 text-fixed-white" style="width: 100%"></div> 
				</div>
			</div>
		</div>
	</div>
</div>
<!-- row closed -->

<!-- row opened -->
<div class="row">
	<div class="col-md-12 col-lg-12 col-xl-7">
		<div class="card custom-card">
			<div class="card-header">
				<div class="card-title">{lang('user_joinings')}</div>
			</div>
			<div class="card-body">
				<div id="user-joinings-bar" class="chartjs-chart"></div>
			</div>
		</div>
	</div>
	<div class="col-lg-12 col-xl-5">
		<div class="card custom-card">
			<div class="card-header">
				<div class="card-title">Bonus</div>
			</div>
			<div class="card-body">
				<canvas id="bonus-doughnut" class="chartjs-chart"></canvas>
			</div>
		</div>
	</div>
</div>
<!-- row closed -->

<!-- row opened -->
<div class="row">
	<div class="col-xl-6 col-md-12 col-lg-6">


		<div class="card">
			<div class="card-body">
				<div class="row">
					<div class="col-md-12">
						<div class="d-flex align-items-center pb-2">
							<p class="mb-0">Total Investments</p>
						</div>
						<h4 class="fw-bold mb-2">{cur_format($total_investment)}</h4>
						<div class="progress progress-style progress-sm">
							<div class="progress-bar bg-secondary-gradient" style="width: 90%" role="progressbar" aria-valuenow="78" aria-valuemin="0" aria-valuemax="78"></div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<div class="card">
			<div class="card-header pb-0">
				<h3 class="card-title mb-2">TICKETS</h3>
				
			</div>
			<div class="card-body sales-info pb-0 pt-0">
				<div id="chart" class="ht-150"></div>
				<div class="row sales-infomation pb-0 mb-0 mx-auto w-100">
					<div class="col-md-6 col">
						<p class="mb-0 d-flex"><span class="legend bg-primary brround"></span>Total</p>
						<h3 class="mb-1">{$ticket_count}</h3>
					</div>
					<div class="col-md-6 col">
						<p class="mb-0 d-flex"><span class="legend bg-info brround"></span>Resolved</p>
						<h3 class="mb-1">{$resolved_count}</h3>
					</div>
				</div>
			</div>
		</div>
		<div class="card ">
			<div class="card-body">
				<div class="row">
					<div class="col-md-6">
						<div class="d-flex align-items-center pb-2">
							<p class="mb-0">Total Sales(Confirmed)</p>
						</div>
						<h4 class="fw-bold mb-2">{cur_format($total_sales)}</h4>
						<div class="progress progress-style progress-sm">
							<div class="progress-bar bg-primary-gradient" style="width: 80%" role="progressbar" aria-valuenow="78" aria-valuemin="0" aria-valuemax="78"></div>
						</div>
					</div>
					<div class="col-md-6 mt-4 mt-md-0">
						<div class="d-flex align-items-center pb-2">
							<p class="mb-0">Total Sales(Pending)</p>
						</div>
						<h4 class="fw-bold mb-2">{cur_format($total_sales_pending)}</h4>
						<div class="progress progress-style progress-sm">
							<div class="progress-bar bg-danger-gradient" style="width: 45%" role="progressbar"  aria-valuenow="45" aria-valuemin="0" aria-valuemax="45"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-12 col-lg-6 col-xl-6">
		<div class="card card-table">
			<div class=" card-header p-0 d-flex justify-content-between">
				<h4 class="card-title mb-1">Top Recruiters</h4>
			</div>
			<div class="table-responsive country-table">
				<table class="table table-striped table-bordered mb-0 text-nowrap">
					<thead>
						<tr>
							<th class="wd-lg-25p"></th>
							<th class="wd-lg-25p">User ID</th>
							<th class="wd-lg-25p">User Name</th>
							<th class="wd-lg-25p">Number of sponsors</th>
						</tr>
					</thead>
					{foreach $top_recruiters as $t}
					<tbody>
						<tr>
							<td><img class="avatar avatar-md rounded-circle my-auto me-3" src="{assets_url()}images/profile/{$t.user_photo}" alt="Profile"></td>
							<td class="fw-medium">{$t.sponsor_name}</td>
							<td class="fw-medium">{$t.sponsor_fullname}</td>
							<td class="fw-medium">{$t.cnt}</td>
						</tr>
					</tbody>
					{/foreach}
				</table>
			</div>
		</div>
	</div>
</div>
<!-- row close -->

<!-- row opened -->
<div class="row">
	<div class="col-md-12 col-lg-12 col-xl-12">
		<div class="card overflow-hidden">
			<div class="card-header pb-1">
				<h3 class="card-title mb-2">{lang('recent_referrals')}</h3>
			</div>
			<div class="card-body p-0 customers mt-1">
				<div class="list-group list-lg-group list-group-flush">
					{foreach $recent_referrals as $rj}
					<div class="list-group-item list-group-item-action">
						<div class="d-flex">
							<img class="avatar avatar-md rounded-circle my-auto me-3" src="{assets_url()}images/profile/{$rj.user_photo}" alt="Profile">
							<div class="flex-grow-1">
								<div class="d-flex align-items-center">
									<div class="mt-0">
										<h5 class="mb-1 fs-15">{$rj.full_name}</h5>
										<p class="mb-0 fs-13 text-muted">User ID: {$rj.user_name} </p>
									</div>
									<div class="ms-auto w-45 fs-16 mt-2">
										<div id="spark1" class="w-100"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
					{/foreach}
				</div>
			</div>
		</div>
	</div>
</div>
<!-- /row -->


{/block}

{block name="footer"}   

<!-- Apex Charts JS -->
<script src="{assets_url()}backend/libs/apexcharts/apexcharts.min.js"></script>

<!-- JSVector Maps JS -->
<script src="{assets_url()}backend/libs/jsvectormap/js/jsvectormap.min.js"></script>

<!-- JSVector Maps MapsJS -->
<script src="{assets_url()}backend/libs/jsvectormap/maps/world-merc.js"></script>
<script src="{assets_url()}backend/js/us-merc-en.js"></script>

<!-- Chartjs Chart JS -->
<script src="{assets_url()}backend/js/index.js"></script>

<!-- Chartjs Chart JS -->
<script src="{assets_url()}backend/libs/chart.js/chart.min.js"></script>


<script src="{assets_url()}plugins/notify/notify.js"></script>
<script type="text/javascript">
	function show() {
		alert('Hi akhil');
	}
	function copyReferral(element) {
		var $temp = $("<input>");
		$("body").append($temp);
		$temp.val($(element).text()).select();
		document.execCommand("copy");
		$temp.remove();
		$.notify(
			"{lang('copied_the_referral')}", 
			{ color: "#fff", background: "#22c03c",blur: 0.4, delay:5000}
			);
	}


	/* User joining chart */
	var options = {
		series: [{
			name: "Users",
			data: [{$joinees}]
		}],
		chart: {
			height: 320,
			type: 'line',
			zoom: {
				enabled: false
			}
		},
		colors: ['#0162e8'],
		dataLabels: {
			enabled: false
		},
		stroke: {
			curve: 'straight',
			width: 3,
		},
		grid: {
			borderColor: '#f2f5f7',
		},
		title: {
			text: 'User Joining by Month',
			align: 'left',
			style: {
				fontSize: '13px',
				fontWeight: 'bold',
				color: '#8c9097'
			},
		},
		xaxis: {
			categories: [{$months}],
			labels: {
				show: true,
				style: {
					colors: "#8c9097",
					fontSize: '11px',
					fontWeight: 600,
					cssClass: 'apexcharts-xaxis-label',
				},
			}
		},
		yaxis: {
			labels: {
				show: true,
				style: {
					colors: "#8c9097",
					fontSize: '11px',
					fontWeight: 600,
					cssClass: 'apexcharts-yaxis-label',
				},
			}
		}
	};
	var chart = new ApexCharts(document.querySelector("#user-joinings-bar"), options);
	chart.render();

	/* Bonus Chart */
	const data3 = {
		labels: [
			'Referral',
			'Rank',
			'Level'
			],
		datasets: [{
			label: 'My First Dataset',
			data: [{$user_wallet['referral_bonus']}, {$user_wallet['rank_bonus']}, {$user_wallet['level_bonus']}],
			backgroundColor: [
				'rgb(245, 184, 73)',
				'rgb(132, 90, 223)',
				'rgb(35, 183, 229)'
				],
			hoverOffset: 4
		}]
	};
	const config4 = {
		type: 'doughnut',
		data: data3,
	};
	const myChart3 = new Chart(
		document.getElementById('bonus-doughnut'),
		config4
		);
	document.addEventListener('DOMContentLoaded', () => {
		const localTimeElement = document.getElementById('local-time');
		const serverTimeElement = document.getElementById('server-time');

    // Function to update local time
		function updateLocalTime() {
			const now = new Date();
			localTimeElement.textContent = now.toLocaleTimeString();
		}

    // Function to get server time
		function getServerTime() {
			const xhr = new XMLHttpRequest();
			xhr.open('GET', '/server-time', true);
			xhr.onreadystatechange = function() {
				if (xhr.readyState == 4 && xhr.status == 200) {
					serverTimeElement.textContent = xhr.responseText;
				}
			};
			xhr.send();
		}

    // Update local time every second
		setInterval(updateLocalTime, 1000);

    // Get server time initially and every 10 seconds
		getServerTime();
		setInterval(getServerTime, 10000);
	});



	function fetchServerTime() {
		$.ajax({
			url:"{base_url('user/dashboard/getTime')}",
			type: 'GET',
			dataType: 'json',
			success: function(response) {
            // Handle successful response
				var serverTime = response.server_time;
				$('#server-time').html(serverTime);
				console.log('Server Time:', response.server_time);
            // You can update your UI with the server time here
			},
			error: function(xhr, status, error) {
            // Handle errors
				console.error('Error fetching server time:', error);
			}
		});
	}
	fetchServerTime();

// Fetch server time every second
setInterval(fetchServerTime, 1000); // 1000 milliseconds = 1 second
</script>

{/block}
