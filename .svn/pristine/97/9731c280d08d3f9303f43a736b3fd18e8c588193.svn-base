{extends file="layout/base.tpl"}

{block body}   
{if !empty($kyc_list)}
<div class="row">
	<div class="col-md-12">
		<div class="card">
			<div class="card-header">
				<h5>KYC DETAILS</h5>
			</div>
			<div class="card-body">
				<div class="row "> 
					<div class="col-sm-12"> 
						<div class="card-body">  
							<div class="dt-ext table-responsive">
								<table class="table table-bordered " id="exportTable">
									<thead >
										<tr>
											<th >Customer Full Name:</th>
											<th >Account No:</th>
											<th>Pancard No:</th>
											<th>Bank Name:</th>
											<th>IFSC:</th>
											<th>Branch:</th>
											<th>Pancard:</th>
											<th>Account Passbook:</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>{$kyc_list['customer_name']}</td>
											<td>{$kyc_list['account_no']}</td>
											<td>{$kyc_list['pan_no']}</td>
											<td>{$kyc_list['account_name']}</td>
											<td>{$kyc_list['ifsc']}</td>
											<td>{$kyc_list['branch']}</td>
											<td><a href="{assets_url('uploads/passbook/')}{$kyc_list['userfile']}" target="_blank"><img src="{assets_url('uploads/passbook/')}{$kyc_list['userfile']}" width="100" height="100"></a></td>
											<td><a href="{assets_url('uploads/passbook/')}{$kyc_list['passbook']}" target="_blank"><img src="{assets_url('uploads/passbook/')}{$kyc_list['passbook']}" width="100" height="100"></a></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div> 
				</div>  
			</div>  
		</div>  
	</div>  
</div>  
{elseif $kyc_pending}
<div class="row">
	<div class="col-md-12">
		<div class="col-xxl-12 col-sm-12 col-12 text-center">
			<div class="card bg-white border-0">
				<div class="alert custom-alert1 alert-primary">

					<div class="text-center px-5 pb-0">
						<svg class="custom-alert-icon svg-primary" xmlns="http://www.w3.org/2000/svg" height="1.5rem" viewBox="0 0 24 24" width="1.5rem" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
						<h5><strong>Awaiting Verification</strong></h5>


					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{else} 
<div class="row">
	<div class="col-md-12">
		<div class="card">
			<div class="card-header">
				<h5>KYC DETAILS</h5>
			</div>
			<div class="card-body">
				{form_open_multipart("{current_url()}",'id="trans_form" name="trans_form" class="row g-3 needs-validation" novalidate=""' )}
				

				<div class="row">
					<div class="col-md-6">
						<div class="form-group bmd-form-group">
							<label class="bmd-label-floating">Customer Full Name:</label>
							<input type="text" class="form-control" name="customer_full_name" id="input-file-now-custom-3" value="{$user_details['customer_full_name']}" required> 
							{form_error('customer_full_name')}
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group bmd-form-group">
							<label class="bmd-label-floating">Account No:</label>

							<input type="number"oninput="validateAccountNumber(this)" class="form-control" name="account_no" id="input-file-now-custom-3" value="{$user_details['account_no']}" required> 
							{form_error('account_no')}
						</div>
					</div>

				</div>
				<div class="row">

					
					<div class="col-md-6">
						<div class="form-group bmd-form-group">
							<label class="bmd-label-floating">Bank Name</label>
							<input type="text" class="form-control" name="account_name" id="pan_no" value="{$user_details['account_name']}" required> 
							{form_error('account_name')}
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group bmd-form-group">
							<label class="bmd-label-floating">IFSC</label>
							<input type="text" class="form-control" name="ifsc" id="ifsc" value="{$user_details['ifsc']}" required> 
							{form_error('ifsc')}
						</div>
					</div>
				</div>
				
				<div class="row">
					
					<div class="col-md-6">
						<div class="form-group bmd-form-group">
							<label class="bmd-label-floating">Branch</label>
							<input type="text" class="form-control" name="branch" id="pan_no" value="{$user_details['branch']}" required> 
							{form_error('branch')}
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group bmd-form-group">
							<label class="bmd-label-floating">Pan No:</label>

							<input type="text" class="form-control" minlength=10 maxlength=10  name="pan_no" id="pan_no" value="{$user_details['pan_card']}" oninput="validatePanNumber(this)"required> 
							{form_error('pan_no')}
						</div>
					</div><div class="col-md-6">
						<div class="form-group bmd-form-group">
							<label class="bmd-label-floating">Adhar No:</label>

							<input type="text" oninput="validateAccountNumber(this)" class="form-control"   name="adhar_no" id="adhar_no" value="{$user_details['adhar_no']}" required> 
							{form_error('adhar_no')}
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-6 col-md-6"> 
						<div class="card">
							<div class="card-body">
								<h4 class="card-title">PAN CARD</h4>
								<label for="input-file-now-custom-1"></label>
								<input type="file" id="input-file-now-custom-2" name="userfile"  class="dropify" data-default-file="{assets_url('uploads/passbook/')}">
							</div>
						</div>
					</div>
					
					<div class="col-lg-6 col-md-6"> 
						<div class="card">
							<div class="card-body">
								<h4 class="card-title">Account Passbook</h4>
								<label for="input-file-now-custom-1"></label>
								<input type="file" id="input-file-now-custom-21" name="passbook"  class="dropify" data-default-file="{assets_url('uploads/passbook/')}">
							</div>
						</div>
					</div>
				</div>
				<div class="p-20"> 
					<span id="gif" style="display: block; margin: 0 auto; visibility: hidden;" class="spinner-border"></span>

					<button class="btn waves-effect waves-light btn-block btn-success" type="submit" id="finish" name="submit" value="submit" class="finish" >
						Upload
					</button>  
				</div>
				{form_close()}
			</div>
		</div>
	</div>
</div>
{/if}
{/block}
{block name="header"}
<link rel="stylesheet" href="{assets_url()}plugins/dropify/dist/css/dropify.min.css">
<link href="{assets_url()}plugins/DataTables/datatables.min.css" rel="stylesheet" />
<link href="{assets_url()}plugins/DataTables/DataTables-1.12.1/css/buttons.dataTables.min.css" rel="stylesheet" />
{/block}
{block name="footer"}
<script src="{assets_url()}plugins/dropify/dist/js/dropify.min.js"></script>

<script src="{assets_url('plugins/sweetalert/lib/sweet-alert.min.js')}"></script>
<script src="{assets_url()}plugins/DataTables/datatables.min.js"></script>
<script src="{assets_url('plugins/DataTables/DataTables-1.12.1/js/jquery.dataTables.min.js')}"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/dataTables.buttons.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/jszip.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/pdfmake.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/vfs_fonts.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/buttons.html5.min.js"></script>
<script src="{assets_url()}plugins/DataTables/DataTables-1.12.1/js/buttons.print.min.js"></script>
<script src="{assets_url('plugins/sweetalert/lib/sweet-alert.min.js')}"></script>
<script src="{assets_url()}plugins/select2/select2.min.js"></script>
<script src="{assets_url()}plugins/notify/notify.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		$('.dropify').dropify();
		$('.dropify-fr').dropify({
			messages: {
			default: 'Glissez-déposez un fichier ici ou cliquez',
				replace: 'Glissez-déposez un fichier ou cliquez pour remplacer',
				remove: 'Supprimer',
				error: 'Désolé, le fichier trop volumineux'
			}
		});
		var drEvent = $('#input-file-events').dropify();
		drEvent.on('dropify.beforeClear', function(event, element) {
			return confirm("Do you really want to delete \"" + element.file.name + "\" ?");
		});

		drEvent.on('dropify.afterClear', function(event, element) {
			alert('File deleted');
		});

		drEvent.on('dropify.errors', function(event, element) {
			console.log('Has Errors');
		});

		var drDestroy = $('#input-file-to-destroy').dropify();
		drDestroy = drDestroy.data('dropify')
		$('#toggleDropify').on('click', function(e) {
			e.preventDefault();
			if (drDestroy.isDropified()) {
				drDestroy.destroy();
			} else {
				drDestroy.init();
			}
		})
	});

	(function () {
		'use strict'
		var forms = document.querySelectorAll('.needs-validation')
		Array.prototype.slice.call(forms)
		.forEach(function (form) {
			form.addEventListener('submit', function (event) {
				if (!form.checkValidity()) {

					event.preventDefault()
					event.stopPropagation()
					
				}

				form.classList.add('was-validated')
			}, false)
		})
	})()
	$(document).ready(function(){
		var order = $('#exportTable').DataTable({
			responsive: true,
			lengthMenu: [
				[10, 50, 100,200,500,1000, {$count}],
				[10, 50, 100,200,500,1000, 'All'],
				],
			
			dom: 'Bfrtip',
			"searching": false,
			"columnDefs": [{
				"targets": [0,1,2,3,4,5,6,7,8], 
				"orderable": false, 
				"className": "no-sort" 

			}],
		});
	});
	function validateAccountNumber(input) {
		input.value = input.value.replace(/[^0-9]/g, '');
	}
	function validatePanNumber(input) {
		input.value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
		const isValid = input.value.length === 10;
		if (!isValid) {
			input.setCustomValidity('Please enter exactly 10 alphanumeric characters.');
		} else {
			input.setCustomValidity(''); 
		}
	}
	function validateIFSC(input) {
		input.value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
		if (input.value.length > 11) {
			input.value = input.value.slice(0, 11);
		}
		if (input.value.length === 0) {
			input.setCustomValidity('');
		} else {
			const isValid = input.value.length === 11;
			input.setCustomValidity(isValid ? '' : 'Please enter exactly 11 alphanumeric characters.');
		}
	}
	document.getElementById('ifsc').addEventListener('input', function() {
		validateIFSC(this);
	});
	$(document).on("click","#finish",function() {
		var fileInput = document.getElementById("input-file-now-custom-2");
		var fileInput1 = document.getElementById("input-file-now-custom-21");
		var allFieldsFilled = true;  
		$("input[required]").each(function() {
			if ($(this).val() === "") {
				allFieldsFilled = false; 
			}
		});
		if (fileInput.files.length != 0 && fileInput1.files.length != 0 && allFieldsFilled) {
			$('#gif').css('visibility', 'visible');
			document.getElementById("finish").style.display = "none";
		}
		return true;
	});
	document.getElementById("finish").addEventListener("click", function (e) {
		
		var fileInput = document.getElementById("input-file-now-custom-2");
		var fileInput1 = document.getElementById("input-file-now-custom-21");
		if (fileInput.files.length == 0 && fileInput1.files.length == 0) {
			alert("Please Select payment Proof");
		}
		$('#input-file-now-custom-2').attr("required", "required");
		$('#input-file-now-custom-21').attr("required", "required");
	});
</script>


{/block}