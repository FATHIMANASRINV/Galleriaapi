{extends file="layout/base.tpl"}
{block name="header"}

<link rel="stylesheet" type="text/css" href="{assets_url('plugins/datepicker/css/metallic/zebra_datepicker.min.css')}">
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.snow.css">
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.bubble.css">

<style type="text/css">
    .mobile {
      display: none;
}
@media (max-width: 360px) {
  .mobile {
    display: block;
  }
}
</style>
{/block}
{block name="body"} 
<div class="row">
    {foreach from=$appointments item=v}
    {$pop_id = $v.id}     
    {$user_name = $v.id}
    <div class="modal" id="panel-config{$pop_id}"  role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" tabindex="1">
                        &times;
                    </button>
                    <h6 class="panel-title">
                        <i class="fa fa-bullhorn fa-lg blue-color" >
                            {lang('text_view_event')}
                        </i>
                    </h6>
                </div>
                <div class="modal-body">

                    <table cellpadding="0" cellspacing="0" align="center">

                        <tr align="justify">
                            <td class="th" colspan="2" style="padding-top:10px;">
                                <b>{lang('text_content')}:</b> <div class="scrolloverview">{$v.full_content}</div>
                            </td>
                        </tr>
                    </table>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-theme" data-dismiss="modal">
                        {lang('text_close')}
                    </button>
                </div>
            </div>
        </div>
    </div>
    {$i=$i+1}
    {/foreach} 


    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-header ">
                <h5 class="mb-0" >
                    {if !empty($individual_events)}
                    <i class="far fa-edit" ></i>
                    {lang('text_edit_events')}
                    {else}             
                    <i class="fas fa-plus-circle" ></i>
                    {lang('text_add_events')}
                    {/if}  
                </h5> 
            </div>
            <div class="card-body">

                {form_open_multipart('','id="event-management" name="event_management" class="form-login needs-validation" novalidate=""')}

                <div class="row">
                    <div class="col-lg-12 col-md-12 col-xs-12">
                        <div class="form-group">   
                            <label class="control-label">
                                {lang('text_subject')}
                            </label><span class="symbol required"></span>
                            <div class="controls">
                                <input type="text" class="form-control" id="heading" name="title" autocomplete="Off"  value = "{$individual_events[0]['title']}" maxlength="50" required>
                                <div class="invalid-feedback">{lang('the_field_required')}</div>

                                {form_error("title")}
                            </div>
                        </div> 
                    </div> 
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="from_date">{lang('from_date')}</label>
                            <div class="col-8">
                                <div class="controls">
                                    <input class="form-control" type="text"  id="from_date" name="start_date" value="{$individual_events[0]['start_date']}" required>
                                    <div class="invalid-feedback">{lang('the_field_required')}</div>

                                    {form_error("start_date")}
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">

                            <label for="end_date">{lang('end_date')}</label>
                            <div class="col-8">
                                <div class="controls">
                                    <input class="form-control" type="text" id="end_date" name="end_date" value="{$individual_events[0]['end_date']}" required>
                                    <div class="invalid-feedback">{lang('the_field_required')}</div>

                                    {form_error("end_date")}
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="location">Location</label>
                            <div class="col-8">
                                <div class="controls">
                                    <input class="form-control" type="text"  id="location" name="location" value="{$individual_events[0]['location']}" required>
                                    <div class="invalid-feedback">{lang('the_field_required')}</div>

                                    {form_error("location")}
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">

                            <label for="end_date">{lang('address')}</label>
                            <div class="col-8">
                                <div class="controls">
                                    <textarea class="form-control" type="text" id="address" name="address" value="{$individual_events[0]['address']}" required>{$individual_events[0]['address']}</textarea>
                                    <div class="invalid-feedback">{lang('the_field_required')}</div>

                                    {form_error("address")}
                                    
                                </div>
                            </div>

                        </div>
                    </div>
                </div>


                    <div class="form-group">

                    <label class="form-label" >{lang('text_description')}</label> 
                    <div class="controls">
                        <div id="editor">{$individual_events[0]['content']}</div> 
                     <textarea cols="50" rows="5" class="form-control d-none"  name='content' id='content' required>{set_value({$individual_events[0]['content']})}</textarea> 
                         {form_error("content")}
                       </div> 
                      </div>


               {*  <div class="form-group">                        
                    <label class="control-label">
                        {lang('text_description')}
                    </label> <span class="symbol required"></span>  
                    <div class="form-group">              
                        <div class="controls">
                            <textarea cols="50" rows="5" class="tinymce d-none" name="content" >{$individual_events[0]['content']}</textarea>                  
                        </div>
                        {form_error('content')}
                    </div>
                </div> *}
                

                <div class="col-md-6">
                    <label class="form-label"> {lang('attachment')}</label><br>                  
                    <a href="" id="thumb-image" data-toggle="image" class="img-thumbnail" style="height: 180px; max-width: 200px;">

                        <img src="{assets_url('images/event_images/')}{$individual_events[0]['image']}" width="200" height="180" alt="">
                        {if empty($image) }
                        <input type="hidden" name="image"  value="{$individual_events[0]['image_id']}" id="input-image"/>
                        {else}
                        <input type="hidden" name="image"  value="{$image}" id="input-image"/>
                        {/if}
                        
                    </a>
                    
                </div>
                <br>
                

                {if !$event_id}
                <div class="form-group">
                    <button class="btn btn-theme" type="submit" id="submit" name="submit" value="submit">
                        {lang('text_submit')} <i class="fa fa-arrow-circle-right"></i>
                    </button>
                </div>
                {else}
                <div class="form-group">
                    <button class="btn btn-theme" type="submit" id="update" name="update" value="update">
                        {lang('text_update')} <i class="fa fa-arrow-circle-right"></i>
                    </button>
                </div>
                {/if}
                {form_close()}
            </div>
        </div>
    </div>
</div>
<br class="mobile" />
<br class="mobile" />
<br class="mobile" />
<br class="mobile" />
{/block}
{block name="footer"}
<script src="{assets_url('plugins/datepicker/zebra_datepicker.min.js')}"></script>
<script src="{assets_url()}backend/vendors/tinymce/tinymce.min.js"></script>
<script src="{assets_url()}backend/js/quill-editor.js"></script>
<script src="{assets_url()}backend/libs/quill/quill.min.js"></script>
<script src="{assets_url()}backend/js/quill-editor.js"></script>
<script type="text/javascript">
    $('#from_date').Zebra_DatePicker({
        pair: $('.to_date')
    });
    $('#end_date').Zebra_DatePicker();
    $(document).on('click', 'a[data-toggle=\'image\']', function(e) 
    { 
        var $element = $(this); 
        var $popover = $element.data('bs.popover'); // element has bs popover?
        e.preventDefault();
        $('a[data-toggle="image"]').popover('dispose');
        if ($popover) {
            return;
        }
        $element.popover({
            html: true,
            placement: 'right',
            content: function() {
                return '<a class="btn btn-falcon-primary me-1 mb-1" type="button" id="button-image" >Edit</a><a class="btn btn-falcon-primary me-1 mb-1" type="button" id="button-clear" >Clear</a>';

            }
        });
        $element.popover('show');
        $('#button-image').on('click', function() {
            var $button = $(this);
            var $icon   = $button.find('> i');
            var $thumb = $element.attr('id');
            var $target = $element.parent().find('input').attr('id');
            $('#modal-image').remove();
            $.ajax({
                url: '{{base_url()}}admin/tools/get_image_gallery_ajax/event_images?target=' + $target + '&thumb=' + $thumb,
                dataType: 'html',
                beforeSend: function() {
                    $button.prop('disabled', true);
                    if ($icon.length) {
                        $icon.attr('class', 'fa fa-circle-o-notch fa-spin');
                    }
                },
                complete: function() {
                    $button.prop('disabled', false);

                    if ($icon.length) {
                        $icon.attr('class', 'fa fa-pencil');
                    }

                } ,
                success: function(html) {
                    console.log(html);

                    $('body ').append('<div id="modal-image" class="modal">' + html + '</div>');
                    $('#modal-image').modal('show');
                    $('#modal-image').modal();
                }
            });
            $element.popover('dispose');
        });
        $('#button-clear').on('click', function() {
            $element.find('img').attr('src', '{{ img_placeholder }}');
            $element.parent().find('input').val('');
            $element.popover('dispose');
        });
    }); 
</script>
<script type="text/javascript">
   

    $("#event-management").on("submit",function(e) {
        var content = $(".ql-editor").html();
        if (content != '<p><br></p>') {
            $("#content").val(content);
        }
        
    });
</script>
{/block}