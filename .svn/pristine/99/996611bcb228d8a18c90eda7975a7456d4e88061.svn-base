{extends file="layout/base.tpl"}
{block name="header"}

<link href="{assets_url()}plugins/select2/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.snow.css">
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.bubble.css">

{/block}
{block name="body"} 
{form_open_multipart('','class="card needs-validation" novalidate="" id="compose"')}
<div class="card-header bg-light">
    <h5 class="mb-0">{lang('new_message')}</h5>
</div>
<div class="card-body p-0">
    <div class="border border-top-0 border-200">
        <div class="form-group">
            <div class="controls">
                <input class="form-control border-0 rounded-0 outline-none px-card" id="email-to" type="text" aria-describedby="email-to" placeholder="{lang('user_name')}" name="user_name" value="admin"  required />
                <div class="invalid-feedback">{lang('user_name_is_required')}</div>

                {form_error("user_name")}
            </div>
        </div>
    </div>
    <div class="border border-y-0 border-200">
        <div class="form-group">
            <div class="controls">
                <input class="form-control border-0 rounded-0 outline-none px-card" id="subject" name="subject"type="text" aria-describedby="email-subject" placeholder="{lang('subject')}" {if $mail_details}value="{$mail_details['subject']}"{/if} required/>
                <div class="invalid-feedback">{lang("subject_is_required")}</div>
            </div>
        </div>
    </div>
    <div class="min-vh-50">
        <div id="editor">{$mail_details['message']}</div>
        <textarea class="tinymce d-none" name="content" id="content"  {if $mail_details}placeholder= "{$mail_details['message']}"{/if} >{if $mail_details}{$mail_details['message']}{/if}
        </textarea>
    </div>
</div>
<div class="card-footer">
    <div class="d-flex align-items-center">
        <button class="btn btn-primary btn-sm px-5 me-2" type="submit" name="send" value="send" id="send">{lang('send')}</button>
        <input class="d-block" id="email-attachment" name="attachment"type="file" {if $mail_details}value="{$mail_details['attachment']}" id="image"{/if}/>
          <span style="color:red;font-size:13px">Max Allowed Size 1000Kb</span>

        <label class="me-2 btn btn-light btn-sm mb-0 cursor-pointer" for="email-attachment" data-bs-toggle="tooltip" data-bs-placement="top" title="Attach files"><span class="fas fa-paperclip fs-1" data-fa-transform="down-2"></span></label>

        <input class="d-none" id="email-image" type="file" />
        <input type="text" name="attachments" {if $mail_details}value="{$mail_details['attachment']}"{/if} hidden>
        <button class="btn btn-light btn-sm" type="button" data-bs-toggle="tooltip" data-bs-placement="top" name="delete" id="delete" title="Delete"> <span class="fas fa-trash"></span></button>

    </div>
</div>

{form_close()}


{/block}
{block name="footer"}
<script src="{assets_url('plugins/ckeditor/ckeditor.js')}"></script>
<script src="{assets_url('plugins/ckeditor/adapters/jquery.js')}"></script>
<script src="{assets_url()}backend/vendors/tinymce/tinymce.min.js"></script>
<script src="{assets_url()}vendors/fontawesome/all.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Quill Editor JS -->
<script src="{assets_url()}backend/libs/quill/quill.min.js"></script>
<!-- Internal Quill JS -->
<script src="{assets_url()}backend/js/quill-editor.js"></script>
<script type="text/javascript">
    $(document).ready(function(){ 
        $('#delete').bind('focus', function() {
            $('#email-attachment').val(''); 
        }) ;


        $('.user_name_ajax').select2({
            multiple: true,
            placeholder: 'Select a User',
            ajax: {
                url: '{base_url()}admin/autocomplete/getUser_ajax',
                type:'post',
                dataType: 'json',
                delay: 250,
                processResults: function (data) { 
                    return {
                        results: data
                    }; 
                },
                cache: true
            }

        }); 
    });

    $("#compose").on("submit",function(e) {
        var content = $(".ql-editor").html();
        if (content != '<p><br></p>') {
            $("#content").val(content);
        }
        
    });
</script>
<script src="{assets_url()}plugins/select2/select2.min.js"></script>
{/block}