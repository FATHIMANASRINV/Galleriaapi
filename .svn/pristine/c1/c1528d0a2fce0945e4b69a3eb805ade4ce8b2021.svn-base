{extends file="layout/base.tpl"}
{block name="header"}

{/block}
{block name="body"}

                <!-- Start::row-1 -->
                <div class="row">
                    <div class="col-lg-12 col-xl-12 col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <!-- Shopping Cart-->
                                <div class="product-details table-responsive text-nowrap">
                                    <table class="table table-bordered table-hover mb-0 text-nowrap">
                                        <thead>
                                            <tr>
                                                <th class="text-start">Product</th>
                                                <th>Quantity</th>
                                                <th>Prize</th>
                                                <!-- <th>Status</th> -->
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                              {foreach from=$cart_contents item=item key=key name=name}
                                            <tr>
                                                <td>
                                                    <div class="media">
                                                        <div class="card-aside-img">
                                                            <img src="{assets_url()}images/products/{$item['options'].img}" alt="img" class="h-60 w-60">
                                                        </div>
                                                        <div class="media-body">
                                                            <div class="card-item-desc mt-0">
                                                                <h6 class="fw-medium mt-0 text-uppercase fs-14">{$item.name}</h6>
                                                                <dl class="card-item-desc-1">
                                                                  <dt>Size: </dt>
                                                                     <dd class="mb-0">{$item['options'].size}</dd>
                                                                 
                                                                </dl>
                                                                <dl class="card-item-desc-1">
                                                                  <dt>Color: </dt>
                                                                 
                                                                   <dd class="mb-0">{$item['options'].color}</dd>
                                                                </dl>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                               <td class="text-center product-quantity-container">
                                                <div class="handle-counter input-group rounded flex-nowrap">
                                                    <button class="btn btn-icon btn-light input-group-text product-quantity-minus" ><i class="ri-subtract-line"></i></button>
                                                    <input type="text" class="form-control form-control-sm text-center" aria-label="quantity" value="{$item.qty}" name="quantity[]" id="quantity[]" min="1">
                                                    <button class="btn btn-icon btn-light input-group-text product-quantity-plus" ><i class="ri-add-line"></i></button>
                                                </div>
                                                <input type="hidden" class="form-control input-number row-id"name="row_id[]" id="row_id[]" value="{$item.rowid}">
                                                </td>
                                                <td class="text-center text-lg text-medium fw-bold  fs-15">{cur_format($item.price)}</td>
                                                <!-- <td class="text-center"><span class="badge bg-danger p-1">Out of stock</span></td> -->
                                                <td class="text-center">
                                                   <a class="btn btn-sm btn-danger-light clear-cart"data-bs-toggle="tooltip" title="" data-bs-original-title="Remove item" data-bs-container=".btn" data-productID="{$item.rowid}"><i class="fe fe-trash"></i></a>
                                                </td>
                                             </tr>
                                             {/foreach}
                                           <!--  <tr>
                                                <td>
                                                    <div class="media">
                                                        <div class="card-aside-img">
                                                            <img src="../assets/images/ecommerce/09.jpg" alt="img" class="h-60 w-60">
                                                        </div>
                                                        <div class="media-body">
                                                            <div class="card-item-desc mt-0">
                                                                <h6 class="fw-medium mt-0 text-uppercase fs-14">Flower pot</h6>
                                                                <dl class="card-item-desc-1">
                                                                  <dt>Size: </dt>
                                                                  <dd class="mb-0">XL</dd>
                                                                </dl>
                                                                <dl class="card-item-desc-1">
                                                                  <dt>Color: </dt>
                                                                  <dd class="mb-0">Red color</dd>
                                                                </dl>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="text-center product-quantity-container">
                                                    <div class="handle-counter input-group rounded flex-nowrap">
                                                        <button class="btn btn-icon btn-light input-group-text product-quantity-minus" ><i class="ri-subtract-line"></i></button>
                                                        <input type="text" class="form-control form-control-sm text-center" aria-label="quantity" id="product-quantity2" value="2">
                                                        <button class="btn btn-icon btn-light input-group-text product-quantity-plus" ><i class="ri-add-line"></i></button>
                                                    </div>
                                                </td>
                                                <td class="text-center text-lg text-medium fw-bold  fs-15">$50.30</td>
                                                <td class="text-center"> <span class="badge bg-success p-1">In stock</span></td>
                                                <td class="text-center">
                                                    <a class="btn  btn-sm btn-danger-light" href="javascript:void(0);" data-bs-toggle="tooltip" title="" data-bs-original-title="Remove item" data-bs-container=".btn"><i class="fe fe-trash"></i></a>
                                                </td>
                                             </tr>
                                            -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer d-flex justify-content-between flex-wrap gap-2">
                                    <div>
                                        <a class="btn btn-secondary" href="my-shop"><i class="fe fe-corner-up-left me-2"></i>Back to Shopping</a>
                                    </div>
                                    <div class="btn-list">
                                        <a class="btn btn-primary update-cart"><i class="fe fe-refresh-cw me-2"></i>Update Cart</a>
                                        <a class="btn btn-outline-primary" href="check-out"><i class="fe fe-log-in me-2"></i>Checkout</a>
                                    </div>
                                
                            </div>
                        </div>
                        </div>
                </div>
                <!--End::row-1 -->

            </div>
        </div>
   

{/block}
{block name="footer"}
<script type="text/javascript">
    $('body').on('click', '.update-cart', function() {
        var rowid = $('input[id^="row_id"]').map(function() {
            return this.value;
        }).get();
        var quantity= $('input[id^="quantity"]').map(function() {
            return this.value;
        }).get();
        $.ajax({
            type:'POST',
            url:'{base_url("user/inventory/update_cart")}',
            data: { row_id: rowid ,  quantity: quantity} ,
            dataType:'json',

        }) .done(function( html ) { 

           if(html.status){ 
            var cart_total = html.cart_total;
            $('.cart-total').html(cart_total); 
            $(".total_price").html(html.total_price);
            $(".shopping-cart").html(html.cart_contents)
            var arr = Object.keys(html.cart_contents_diplay).map(function (key) { return html.cart_contents_diplay[key]; });
            var htmls= '';
            $(arr).each(function(key,value) {
                var subtotal = parseFloat(value.subtotal).toFixed(2)
                var price = parseFloat(value.price).toFixed(2)

                $(".subtotal_"+value.rowid).text(value.sub_total);

                // htmls += '<tr><td><a href="{base_url()}product-details/'+value.slug_url+'"><img src="{assets_url()}images/products/'+value.options.img+'" alt=""></a></td><td><a href="{base_url()}product-details/'+value.slug_url+'">'+value.name+'</a><div class="mobile-cart-content row"><div class="col-xs-3"><div class="qty-box"><div class="input-group"><input type="text" name="quantity_mob[]" id="'+value.rowid+'" class="form-control input-number" value="'+value.qty+'"></div></div></div><div class="col-xs-3"><h2 class="td-color">'+price+'</h2></div><div class="col-xs-3"><h2 class="td-color"><a href="#" class="icon"><i class="ti-close"></i></a></h2> </div></div></td><td><h2>$'+price+'</h2></td><td><div class="qty-box"> <div class="input-group"><input type="number" name="quantity[]" id="quantity[]" class="form-control input-number quantity" value="'+value.qty+'" min="1"></div> </div> </td><td><a href="{base_url('delete-product/')}'+value.rowid+'" class="icon"><i class="ti-close"></i></a></td><td class="td-colorss"><h2 class="td-color">$'+subtotal+'</h2></td> </tr><input type="hidden" class="form-control input-number row-id"name="row_id[]" id="row_id[]" value="'+value.rowid+'">';

            });
            // $('.subtotal_menu').empty().append(htmls);
            toastr.success('Updated Cart Successfully',"Success: ",{ progressBar:!0 });
        }else{ 
            toastr.error(html.msg,"False: ",{ progressBar:!0 }) 
        } 
    })

    });
    $('body').on('click', '.clear-cart', function() {
        var id= $(this).attr("data-productID");
        // var $clickedButton = $(this); 
        $.ajax({
            type:'POST',
            url:'{base_url("user/inventory/remove_product")}',
            dataType:'json',
            data: { id: id },

        }).done(function( html ) {
             // toastr.success('Your Item Cleared Successfully',"Success:",{ progressBar:!0 });
            window.location.href = "product-cart";
            if(html.status){ 
                var cart_total = html.cart_total;
                $('.cart-total').html(cart_total); 
                $(".shopping-cart").html(html.cart_contents)
                toastr.success('Your Cart Cleared Successfully',"Success:",{ progressBar:!0 });
                window.location.href = "product-cart";
            }else{ 
                toastr.error(html.msg,"Please try again ",{ progressBar:!0 }) 
            } 

        });

    });
</script>
{/block}
