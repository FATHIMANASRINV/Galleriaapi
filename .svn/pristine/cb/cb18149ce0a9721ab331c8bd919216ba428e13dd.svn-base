{extends file="layout/base.tpl"}
{block name="header"}
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.snow.css">
<link rel="stylesheet" href="{assets_url()}backend/libs/quill/quill.bubble.css">
<link href="{assets_url()}plugins/select2/select2.min.css" rel="stylesheet" />
<script>
  var isRTL = JSON.parse(localStorage.getItem('isRTL'));
  if (isRTL) {
    var linkDefault = document.getElementById('style-default');
    var userLinkDefault = document.getElementById('user-style-default');
    linkDefault.setAttribute('disabled', true);
    userLinkDefault.setAttribute('disabled', true);
    document.querySelector('html').setAttribute('dir', 'rtl');
} else {
    var linkRTL = document.getElementById('style-rtl');
    var userLinkRTL = document.getElementById('user-style-rtl');
    linkRTL.setAttribute('disabled', true);
    userLinkRTL.setAttribute('disabled', true);
}
</script>
{/block}
{block name="body"} 

{form_open_multipart('','id="news_update_form" class="card needs-validation" novalidate=""')}
<div class="card-header bg-light">
  <h5 class="mb-0">{lang('new_message')}</h5>
</div>
<div class="card-body p-0">
  <div class="border border-top-0 border-200">
    <div class="form-group">
        <div class="controls">
            <select name="user_name[]" id="user_name[]" class="form-control user_name_ajax" {set_select('user_name', set_value('user_name'))} required>

                {if $user_name}
                <option value="{$user_name}" selected>{$user_name}</option>
                {/if}
            </select>
            <div class="invalid-feedback">{lang('user_name_is_required')}</div>

            {form_error("user_name")}
        </div>
    </div>
</div>
<div class="border border-y-0 border-200">
    <div class="form-group">
        <div class="controls">
            <input class="form-control border-0 rounded-0 outline-none px-card" id="subject" name="subject"type="text" aria-describedby="email-subject" placeholder="{lang('subject')}" {if $mail_details}value="{$mail_details['subject']}"{/if} required />
            <div class="invalid-feedback">{lang('subject_is_required')}</div>

            {form_error("subject")}
        </div>
    </div>
</div>

<div class="form-group">

                    <label class="form-label" ></label> 
                    <div class="controls">
                        <div id="editor">{$mail_details['message']}</div> 
                     <textarea cols="50" rows="5" class="form-control d-none"  name='content' id='content' required>{set_value('message')}</textarea> 
                         {form_error("content")}
                       </div> 
                      </div>

{* <div class="min-vh-50">
    <textarea class="tinymce d-none" name="content" id="content"  {if $mail_details}placeholder= "{$mail_details['message']}"{/if} >{if $mail_details}{$mail_details['message']}{/if}</textarea>
</div> *}
</div>
<div class="card-footer">
  <div class="d-flex align-items-center">
    <button class="btn btn-primary btn-sm px-5 me-2" type="submit" name="send" value="send" id="send">{lang('send')}</button>
    <input class="d-block" id="email-attachment" name="attachment" id="attachment"type="file" />
    <input type="text" name="attachments" {if $mail_details}value="{$mail_details['attachment']}"{/if} hidden>
              <span style="color:red;font-size:13px">Max Allowed Size 1000Kb</span>

    <label class="me-2 btn btn-light btn-sm mb-0 cursor-pointer" for="email-attachment" data-bs-toggle="tooltip" data-bs-placement="top" title="Attach files"><span class="fas fa-paperclip fs-1" data-fa-transform="down-2"></span></label>
    <input class="d-none" id="email-image" type="file" accept="image/*" />
    {*   <label class="btn btn-light btn-sm mb-0 cursor-pointer" for="email-image" data-bs-toggle="tooltip" data-bs-placement="top" title="Attach images"><span class="fas fa-image fs-1" data-fa-transform="down-2"></span></label> *}
    <button class="btn btn-light btn-sm" type="button" data-bs-toggle="tooltip" data-bs-placement="top" id="delete" title="Delete"> <span class="fas fa-trash"></span></button>
</div>
</div>
{form_close()}
{/block}
{block name="footer"}
{* <script src="{assets_url('plugins/validation/js/jqBootstrapValidation.js')}"></script> *}
{* <script src="{assets_url('plugins/validation/js/form-validation.js')}"></script>
*}<script src="{assets_url('plugins/ckeditor/ckeditor.js')}"></script>
<script src="{assets_url('plugins/ckeditor/adapters/jquery.js')}"></script>
<script src="{assets_url()}backend/vendors/tinymce/tinymce.min.js"></script>
<script src="{assets_url()}backend/libs/quill/quill.min.js"></script>
<script src="{assets_url()}backend/js/quill-editor.js"></script>
<script src="{assets_url()}vendors/fontawesome/all.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
    //   $("#delete").click(function(){
    //     $("#email-attachment").remove();
    // });

    $('#delete').bind('focus', function() {
       $('#email-attachment').val(''); 
   }) ;
      $("#news_update_form").on("submit",function(e) {
        var content = $(".ql-editor").html();
        if (content != '<p><br></p>') {
            $("#content").val(content);
        }
        
    });

    $('.user_name_ajax').select2({
        multiple: true,
        placeholder: '{lang('select_a_user')} ',
        ajax: {
            url: '{base_url()}admin/autocomplete/getUser_ajax',
            type:'post',
            dataType: 'json',
            delay: 250,
            processResults: function (data) { 
                return {
                    results: data
                };

            },
            cache: true
        }

    }); 
});
</script>
<script src="{assets_url()}plugins/select2/select2.min.js"></script>
{/block}